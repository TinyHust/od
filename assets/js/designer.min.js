/* nbdesignerjs
 * @author  netbaseteam
 * @link https://cmsmart.net
 * @version 1.7.0
 * @created Jun 2016
 * @modified 09, Mar 2017
 * */
function checkFireFox() {
    if (navigator.userAgent.toLowerCase().indexOf("firefox") > -1) return true
}
var langjs = {
    "DELETE_ITEM_MESSAGE" : "Are you sure you want to delete this item?",
    "DELETE_ALL_ITEM_MESSAGE" : "Are you sure you want to delete all layers?",
    "LAYER_IMAGE" : "Image",
    "LAYER_GROUP" : "Group",
    "LAYER_PATH" : "Path",
    "LAYER_RECTANGLE" : "Rectangle",
    "LAYER_CIRCLE" : "Circle",
    "LAYER_TRIANGLE" : "Triangle",
    "LAYER_LINE" : "Line",
    "LAYER_POLYGON" : "Polygon",
    "LANGUAGE" : "Language",
    "PREVIEW" : "Preview",
    "ZOOM_IN" : "Zoom In",
    "ZOOM_OUT" : "Zoom Out",
    "TEMPLATE" : "Template",
    "ALIGN" : "Align",
    "ALIGN_LEFT" : "Align Left",
    "ALIGN_RIGHT" : "Align Right",
    "ALIGN_TOP" : "Align Top",
    "ALIGN_BOTTOM" : "Align Bottom",
    "ALIGN_MIDDLE_VERTICAL" : "Align Middle Vertival",
    "ALIGN_MIDDLE_HORIZONTAL" : "Align Middle Horizontal",
    "UNDO" : "Undo",
    "REDO" : "Redo",
    "DOWNLOAD" : "Download",
    "SNAP_GRID" : "Snap grid",
    "PNG" : "PNG",
    "JPG" : "JPG",
    "PDF" : "PDF",
    "LOCK" : "Lock",
    "ELEMENT_UPLOAD" : "Element Upload",
    "LOCK_ALL_ADJUSMENT" : "Lock all adjustment",
    "LOCK_HORIZONTAL_MOVEMENT" : "Lock horizontal movement",
    "LOCK_VERTITAL_MOVEMENT" : "Lock vertical movement",
    "LOCK_HORIZONTAL_SCALING" : "Lock horizontal scaling",
    "LOCK_VERTITAL_SCALING" : "Lock vertical scaling",
    "DISABLE_DRAW_MODE" : "Disable draw mode",
    "LOCK_ROTATION" : "Lock rotation",
    "DESELECT_GROUP" : "Deselect group",
    "REPLACE_IMAGE" : "Replace image",
    "MES_ALLOW_UPLOAD_IMG" : "Only images are allowed",
    "MES_ERROR_MAXSIZE_UPLOAD" : "Oops, file upload larger than",
    "MES_ERROR_MINSIZE_UPLOAD" : "Oops, file upload smaller than",
    "FONT_CAT" : "Font Categories",
    "CAT" : "Categories",
    "TERM_ALERT" : "Please read and accept the terms"
};
function checkIE() {
    var ua = window.navigator.userAgent;
    var msie = ua.indexOf("MSIE ");
    if (msie > 0 || !!navigator.userAgent.match(/Trident.*rv\:11\./)) return true;
    else return false;
    return false
}
(function(c) {
    var b, d, e, f, g, h = c.body,
        a = c.createElement("div");
    a.innerHTML = '<span style="' + ["position:absolute", "width:auto", "font-size:128px", "left:-99999px"].join(" !important;") + '">' + Array(100).join("wi") + "</span>";
    a = a.firstChild;
    b = function(b) {
        a.style.fontFamily = b;
        h.appendChild(a);
        g = a.clientWidth;
        h.removeChild(a);
        return g
    };
    d = b("monospace");
    e = b("serif");
    f = b("sans-serif");
    window.isFontAvailable = function(a) {
        return d !== b(a + ",monospace") || f !== b(a + ",sans-serif") || e !== b(a + ",serif")
    }
})(document);
window.performance = window.performance || {};
performance.now = function() {
    return performance.now || performance.mozNow || performance.msNow || performance.oNow || performance.webkitNow || Date.now
}();
var canvas = null;
var canvasContainerX = 0;
var canvasContainerY = 0;
var colorTrend = ["f98332", "A31A48", "4C49A2", "B8DC3C", "CB2402", "DB2464", "35235D", "EA3556", "61D2D6", "EDE5E2", "ED146F", "EDDE45", "9BF0E9"];
function hexToRGB(hex) {
    var shorthandRegex = /^#?([a-f\d])([a-f\d])([a-f\d])$/i;
    hex = hex.replace(shorthandRegex, function(m, r, g, b) {
        return r + r + g + g + b + b
    });
    var result = /^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(hex);
    return result ? {
        r: parseInt(result[1], 16),
        g: parseInt(result[2], 16),
        b: parseInt(result[3], 16)
    } : null
}
function toType(obj) {
    return {}.toString.call(obj).match(/\s([a-zA-Z]+)/)[1].toLowerCase()
}
function changePattern(url) {
    fabric.util.loadImage(url, function(img) {
        var fill = new fabric.Pattern({
            source: img,
            repeat: "repeat"
        });
        var scope = angular.element(document.getElementById("designer-controller")).scope();
        scope.canvas.item(scope.editableItem).fill = fill;
        scope.canvas.setActiveObject(scope.canvas.item(scope.canvas.getObjects().length - 1));
        if (scope.$root.$$phase !== "$apply" && scope.$root.$$phase !== "$digest") scope.$apply()
    })
}
function degToRad(degrees) {
    return degrees * (Math.PI / 180)
}
function show_indicator() {
    $(".od_processing").show();
    $(".od_processing").css("opacity", 1)
}
function checkNavigator() {
    var ua = window.navigator.userAgent,
        msie = ua.indexOf("MSIE "),
        support = true;
    if (msie > 0) {
        var ver = parseInt(ua.substring(msie + 5, ua.indexOf(".", msie)), 10);
        if (ver < 10) support = false
    }
    return support
}
function hide_indicator() {
    var support = checkNavigator();
    if (!support) {
        $("#first_message").html("Oops! My app not support IE version less than 10...<br /><span>Try with model browser.</span>");
        $(".od_processing").show();
        $(".od_processing").css("opacity", 1)
    } else {
        $(".od_processing").hide();
        $(".od_processing").css("opacity", 0)
    }
}
function show_processing() {
    $("#nbdesigner_processing").addClass("show")
}
function hide_processing() {
    $("#nbdesigner_processing").removeClass("show")
}
function addColorStop() {
    var html = '<div class="row container_color_stop">';
    html += '<div class="col-xs-6">';
    html += '<input type="text" class="ip_shadow jscolor gradient_stop_color" value="F98332" >';
    html += '<input type="text" class="ip_shadow special gradient_stop" value="0">';
    html += '</div><div class="col-xs-5 nb_slider"></div>';
    html += '<div class="clear"></div></div>';
    jQuery("#gradient").append(html);
    jQuery(".nb_slider").slider({
        animate: true,
        slide: function(event, ui) {
            jQuery(this).parent().find(".gradient_stop").val(ui.value /
                100)
        }
    });
    jscolor.installByClassName("jscolor")
}
function removeColorStop() {
    jQuery("#gradient .container_color_stop:last-child").remove()
}
function createGradient() {
    var option = {};
    var length = jQuery("#gradient .container_color_stop").length - 1;
    jQuery("#gradient .container_color_stop").each(function(key, data) {
        var stop = 0;
        stop = jQuery(this).find(".gradient_stop").val();
        if (key == 0) stop = 0;
        if (key == length) stop = 1;
        temp = stop;
        var color = "#" + jQuery(this).find(".gradient_stop_color").val();
        option[stop] = color
    });
    return option
}
function getBinary(file) {
    var xhr = new XMLHttpRequest;
    xhr.open("GET", file, false);
    xhr.overrideMimeType("text/plain; charset=x-user-defined");
    xhr.send(null);
    return xhr.responseText
}
function base64Encode(str) {
    var CHARS = "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";
    var out = "",
        i = 0,
        len = str.length,
        c1, c2, c3;
    while (i < len) {
        c1 = str.charCodeAt(i++) & 255;
        if (i == len) {
            out += CHARS.charAt(c1 >> 2);
            out += CHARS.charAt((c1 & 3) << 4);
            out += "==";
            break
        }
        c2 = str.charCodeAt(i++);
        if (i == len) {
            out += CHARS.charAt(c1 >> 2);
            out += CHARS.charAt((c1 & 3) << 4 | (c2 & 240) >> 4);
            out += CHARS.charAt((c2 & 15) << 2);
            out += "=";
            break
        }
        c3 = str.charCodeAt(i++);
        out += CHARS.charAt(c1 >> 2);
        out += CHARS.charAt((c1 & 3) << 4 | (c2 & 240) >> 4);
        out +=
            CHARS.charAt((c2 & 15) << 2 | (c3 & 192) >> 6);
        out += CHARS.charAt(c3 & 63)
    }
    return out
}
function checkMobileDevice(){
    var isMobile = false; 
    if(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|ipad|iris|kindle|Android|Silk|lge |maemo|midp|mmp|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows (ce|phone)|xda|xiino/i.test(navigator.userAgent) 
    || /1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(navigator.userAgent.substr(0,4))) isMobile = true;    
    return isMobile;
};
(function() {   
    jQuery("#dg-outline-width").slider({
        animate: true,
        slide: function(event, ui) {
            jQuery(".outline-value").html(ui.value);
            var scope = angular.element(document.getElementById("designer-controller")).scope();
            scope.editable.strokeTemp = ui.value / 100 * 5;
            scope.changeStroke(null, scope.editable.strokeTemp);
            if (scope.$root.$$phase !== "$apply" && scope.$root.$$phase !== "$digest") scope.$apply()
        }
    });
    jQuery(".nb_slider").slider({
        animate: true,
        slide: function(event, ui) {
            jQuery(this).parent().find(".gradient_stop").val(ui.value /
                100)
        }
    });
    jQuery("#opacity-text").slider({
        animate: true,
        min: 0,
        max: 1,
        step: .01,
        slide: function(event, ui) {
            var scope = angular.element(document.getElementById("designer-controller")).scope();
            scope.setOpacity(ui.value);
            if (scope.$root.$$phase !== "$apply" && scope.$root.$$phase !== "$digest") scope.$apply()
        }
    });
    jQuery('[data-toggle="tooltip"]').tooltip();
    jQuery("#text-arc").slider({
        animate: true,
        slide: function(event, ui) {
            var scope = angular.element(document.getElementById("designer-controller")).scope();
            jQuery("#text-arc-value").html(ui.value);
            scope.changeCurve(ui.value);
            if (scope.$root.$$phase !== "$apply" && scope.$root.$$phase !== "$digest") scope.$apply()
        }
    });
    jQuery("#shadow_x, #image_shadow_x").slider({
        animate: true,
        min: 0,
        max: 25,
        slide: function(event, ui) {
            var scope = angular.element(document.getElementById("designer-controller")).scope();
            scope.shadow.x = ui.value;
            scope.changeShadow();
            if (scope.$root.$$phase !== "$apply" && scope.$root.$$phase !== "$digest") scope.$apply()
        }
    });
    jQuery("#shadow_blur, #image_shadow_blur").slider({
        animate: true,
        min: 0,
        max: 25,
        slide: function(event,
            ui) {
            var scope = angular.element(document.getElementById("designer-controller")).scope();
            scope.shadow.blur = ui.value;
            scope.changeShadow();
            if (scope.$root.$$phase !== "$apply" && scope.$root.$$phase !== "$digest") scope.$apply()
        }
    });
    jQuery("#brush_width").slider({
        animate: true,
        min: 0,
        max: 50,
        slide: function(event, ui) {
            var scope = angular.element(document.getElementById("designer-controller")).scope();
            scope.brushWidth = ui.value;
            scope.setDrawingLineWidth(scope.brushWidth);
            if (scope.$root.$$phase !== "$apply" && scope.$root.$$phase !==
                "$digest") scope.$apply()
        }
    });
    jQuery("#brush_opacity").slider({
        animate: true,
        min: 0,
        max: 1,
        step: .01,
        slide: function(event, ui) {
            var scope = angular.element(document.getElementById("designer-controller")).scope();
            scope.brushOpacity = 1 - ui.value;
            scope.setDrawingLineOpacity(scope.brushOpacity);
            if (scope.$root.$$phase !== "$apply" && scope.$root.$$phase !== "$digest") scope.$apply()
        }
    });
    jQuery("#brush_shadow_width").slider({
        animate: true,
        min: 0,
        max: 150,
        slide: function(event, ui) {
            var scope = angular.element(document.getElementById("designer-controller")).scope();
            scope.brushShadowWidth = ui.value;
            scope.setDrawingLineShadowWidth(scope.brushShadowWidth);
            if (scope.$root.$$phase !== "$apply" && scope.$root.$$phase !== "$digest") scope.$apply()
        }
    });
    jQuery("#shadow_y, #image_shadow_y").slider({
        animate: true,
        min: 0,
        max: 25,
        slide: function(event, ui) {
            var scope = angular.element(document.getElementById("designer-controller")).scope();
            scope.shadow.y = ui.value;
            scope.changeShadow();
            if (scope.$root.$$phase !== "$apply" && scope.$root.$$phase !== "$digest") scope.$apply()
        }
    });
    jQuery("#shadow_alpha, #image_shadow_alpha").slider({
        animate: true,
        min: 0,
        max: 1,
        step: .01,
        slide: function(event, ui) {
            var scope = angular.element(document.getElementById("designer-controller")).scope();
            scope.shadow.alpha = 1 - ui.value;
            scope.changeShadow();
            if (scope.$root.$$phase !== "$apply" && scope.$root.$$phase !== "$digest") scope.$apply()
        }
    });
    jQuery("#opacity_shape").slider({
        animate: true,
        min: 0,
        max: 1,
        step: .01,
        slide: function(event, ui) {
            var scope = angular.element(document.getElementById("designer-controller")).scope();
            scope.setOpacity(ui.value);
            if (scope.$root.$$phase !== "$apply" && scope.$root.$$phase !==
                "$digest") scope.$apply()
        }
    });
    jQuery("#opacity_svg, #image_opacity").slider({
        animate: true,
        min: 0,
        max: 1,
        step: .01,
        slide: function(event, ui) {
            var scope = angular.element(document.getElementById("designer-controller")).scope();
            scope.setOpacity(ui.value);
            if (scope.$root.$$phase !== "$apply" && scope.$root.$$phase !== "$digest") scope.$apply()
        }
    });
    $("a.nb_toggle_popoup").on("click", function(e) {
        e.preventDefault();
        $(this).parent().find("div.nb_toggle_popoup").toggle()
    });
    $("#rotation-text, #rotation-image, #rotation-shape, #rotation-svg").knob({
        width: 50,
        height: 50,
        min: -1,
        max: 360,
        fgColor: "#DD577A",
        bgColor: "#9BF0E9",
        displayPrevious: false,
        readOnly: false,
        cursor: 10,
        thickness: ".3",
        "change": function(v) {
            var object = canvas.getActiveObject();
            if (object != null) {
                object.setAngle(v);
                canvas.renderAll()
            }
        },
        "release": function(v) {
            var object = canvas.getActiveObject();
            if (object != null) {
                object.setAngle(v);
                canvas.renderAll()
            }
        }
    });
    $(".accordion").accordion({
        collapsible: true,
        heightStyle: "content"
    });
    $(".nb_acc, .has-croll").perfectScrollbar();
    if (jQuery(".popovers").length) jQuery(".popovers").popover();
    function applyFilter(index, filter) {
        var scope = angular.element(document.getElementById("designer-controller")).scope();
        var object = scope.canvas.getActiveObject();
        if (object == null) return;
        object.filters[index] = filter;
        object.applyFilters(function() {
            scope.canvas.renderAll(canvas.renderAll.bind(canvas))
        });
        if (scope.$root.$$phase !== "$apply" && scope.$root.$$phase !== "$digest") scope.$apply()
    }
    function applyFilterValue(index, prop, value) {
        var scope = angular.element(document.getElementById("designer-controller")).scope();
        var object = scope.canvas.getActiveObject();
        if (object == null) return;
        if (object.filters[index]) {
            object.filters[index][prop] = value;
            object.applyFilters(canvas.renderAll.bind(canvas))
        }
        if (scope.$root.$$phase !== "$apply" && scope.$root.$$phase !== "$digest") scope.$apply()
    }
    f = fabric.Image.filters;
    $("#grayscale-filter").on("change", function() {
        applyFilter(0, this.checked && new f.Grayscale)
    });
    $("#invert-filter").on("change", function() {
        applyFilter(1, this.checked && new f.Invert)
    });
    $("#sepia-filter").on("change", function() {
        applyFilter(3,
            this.checked && new f.Sepia)
    });
    $("#sepia2-filter").on("change", function() {
        applyFilter(4, this.checked && new f.Sepia2)
    });
    $("#remove-color-filter").on("change", function() {
        applyFilter(20, this.checked && new f.RemoveColor({
            color: [255, 205, 109]
        }))
    });
    $("#remove-white-filter").on("change", function() {
        applyFilter(2, this.checked && new f.RemoveWhite({
            threshold: $("#remove-white-threshold").value,
            distance: $("#remove-white-distance").value
        }))
    });
    $("#brightness-filter").on("change", function() {
        applyFilter(5, this.checked &&
            new f.Brightness({
                brightness: parseInt($("#brightness-value").value, 10)
            }))
    });
    $("#noise-filter").on("change", function() {
        applyFilter(6, this.checked && new f.Noise({
            noise: parseInt($("#noise-value").value, 10)
        }))
    });
    $("#gradient-transparency-filter").on("change", function() {
        applyFilter(7, this.checked && new f.GradientTransparency({
            threshold: parseInt($("#gradient-transparency-value").value, 10)
        }))
    });
    $("#pixelate-filter").on("change", function() {
        applyFilter(8, this.checked && new f.Pixelate({
            blocksize: parseInt($("#pixelate-value").value,
                10)
        }))
    });
    $("#blur-filter").on("change", function() {
        applyFilter(9, this.checked && new f.Convolute({
            matrix: [1 / 9, 1 / 9, 1 / 9, 1 / 9, 1 / 9, 1 / 9, 1 / 9, 1 / 9, 1 / 9]
        }))
    });
    $("#sharpen-filter").on("change", function() {
        applyFilter(10, this.checked && new f.Convolute({
            matrix: [0, -1, 0, -1, 5, -1, 0, -1, 0]
        }))
    });
    $("#emboss-filter").on("change", function() {
        applyFilter(11, this.checked && new f.Convolute({
            matrix: [1, 1, 1, 1, .7, -1, -1, -1, -1]
        }))
    });
    $("#edge-enhance-filter").on("change", function() {
        applyFilter(11, this.checked && new f.Convolute({
            matrix: [-1, -1, -1, -1, 9, -1, -1, -1, -1]
        }))
    });
    $("#tint-filter").on("change", function() {
        applyFilter(12, this.checked && new f.Tint({
            color: jQuery("#tint-color").val(),
            opacity: parseFloat(jQuery("#tint-opacity").val())
        }))
    });
    $("#tint-color").on("change", function() {
        applyFilterValue(12, "color", this.value)
    });
    $("#multiply-filter").on("change", function() {
        applyFilter(13, this.checked && new f.Multiply({
            color: document.getElementById("multiply-color").value
        }))
    });
    $("#multiply-color").on("change", function() {
        applyFilterValue(13, "color",
            this.value)
    });
    var blend_mode = "add";
    $("#blend-filter").on("change", function() {
        applyFilter(14, this.checked && new f.Blend({
            color: document.getElementById("blend-color").value,
            mode: blend_mode
        }))
    });
    changeBlendMode = function(mode) {
        blend_mode = mode;
        applyFilterValue(14, "mode", mode)
    };
    $("#blend-color").on("change", function() {
        applyFilterValue(14, "color", this.value)
    });
    var filter = {
        "grayscale": 0,
        "invert": 1,
        "remove-white": 2,
        "sepia": 3,
        "sepia2": 4,
        "brightness": 5,
        "noise": 6,
        "gradient-transparency": 7,
        "pixelate": 8,
        "blur": 9,
        "sharpen": 10,
        "emboss": 11,
        "tint": 12,
        "multiply": 13,
        "blend": 14,
        "edge-enhance": 15
    };
    jQuery(".remove-white-threshold, .remove-white-distance, .brightness-value, .gradient-transparency-value").slider({
        animate: true,
        max: 255,
        slide: function(event, ui) {
            var index = filter[jQuery(this).next().data("parent")];
            var type = jQuery(this).next().data("type");
            jQuery(this).next().val(ui.value);
            applyFilterValue(index, type, parseInt(ui.value))
        }
    });
    jQuery(".noise-value").slider({
        animate: true,
        max: 1E3,
        slide: function(event, ui) {
            var index =
                filter[jQuery(this).next().data("parent")];
            var type = jQuery(this).next().data("type");
            jQuery(this).next().val(ui.value);
            applyFilterValue(index, type, parseInt(ui.value))
        }
    });
    jQuery(".pixelate-value").slider({
        animate: true,
        min: 2,
        max: 20,
        slide: function(event, ui) {
            var index = filter[jQuery(this).next().data("parent")];
            var type = jQuery(this).next().data("type");
            jQuery(this).next().val(ui.value);
            applyFilterValue(index, type, parseInt(ui.value))
        }
    });
    jQuery(".tint-opacity").slider({
        animate: true,
        min: 0,
        max: 1,
        step: .1,
        slide: function(event,
            ui) {
            var index = filter[jQuery(this).next().data("parent")];
            var type = jQuery(this).next().data("type");
            jQuery(this).next().val(ui.value);
            applyFilterValue(index, type, parseFloat(ui.value))
        }
    });
    applyImageFilters = function() {
        canvas.forEachObject(function(obj) {
            if (obj.type === "image" && obj.filters.length) obj.applyFilters(function() {
                obj.canvas.renderAll()
            })
        })
    };
    var mobile = checkMobileDevice();
    if(!mobile){
        jQuery("#layers").sortable({
            stop: function(event, ui) {
                var scope = angular.element(document.getElementById("designer-controller")).scope();
                var chain = [];
                jQuery("#layers .layer").each(function() {
                    chain.push(jQuery(this).attr("id").replace("layer-",""))
                });
                chain = chain.reverse();
                var length = chain.length;
                if (length == 1) return;
                var temp = [],
                    temp1 = [];
                _.each(chain, function(value, key) {
                    chain[key] = parseInt(value);
                    if (chain[key] - key != 0) temp.push(key);
                    if (chain[key] - key > 1 || chain[key] - key < -1) {
                        temp1.push(chain[key]);
                        temp1.push(key)
                    }
                });
                if (temp1.length == 0) {
                    var from = temp[0];
                    var to = temp[1]
                } else {
                    var from = temp1[0];
                    var to = temp1[1]
                }
                scope.sortLayer(from, to);
                if (scope.$root.$$phase !== "$apply" && scope.$root.$$phase !== "$digest") scope.$apply()
            }
        })
    }
    canvas = new fabric.Canvas("designer-canvas");
    canvas.selection = false;
    canvas.on("selection:cleared", function(options) {
        var scope = angular.element(document.getElementById("designer-controller")).scope();
        scope.canvas = canvas;
        scope.closePopover();
        if (scope.$root.$$phase !== "$apply" && scope.$root.$$phase !== "$digest") scope.$apply();
        var mobile = false;
        if ($(window).width() < 768) mobile = true;
        if (mobile) hideConfig();
        if ($("#addition_tool").hasClass("open")) $("#addition_tool .menu_right").triggerHandler("click");
        $('#replace-element-upload').hide();
        scope.editableItem = null;
        scope.shapeMode = false
    });
    canvas.on("mouse:down", function(options) {
        var scope = angular.element(document.getElementById("designer-controller")).scope();
        var object = options.target;
        if(scope.canvas.getActiveGroup()){
            scope.canvas.getActiveGroup().set({
                hasRotatingPoint: false,
                borderColor: "rgba(220, 220, 220, 1)"
            });
            scope.canvas.getActiveGroup().forEachObject(function(obj) {
                obj.set({borderColor: "rgba(220, 220, 220, 0)"});
            });                 
            scope.showAlignToolbar = true;
        }else{
            scope.showAlignToolbar = false;
        }
        if (object == null ) return;  
        var angle = object.angle;
        if (object.angle > 360) angle = angle - 360;
        if (angle < 0) angle = angle + 360;        
        scope.currentItemParameters = {
            'left' : object.left,
            'top' : object.top,
            'scaleX' : object.scaleX,
            'scaleY' : object.scaleY,
            'angle' : angle
        };        
        if (scope.$root.$$phase !== "$apply" && scope.$root.$$phase !== "$digest") scope.$apply()
    });
    canvas.on("mouse:over", function(e) {
        var thisItem = canvas.getObjects().indexOf(e.target);
        var selectedItem = canvas.getObjects().indexOf(canvas.getActiveObject());
        if (thisItem != selectedItem);
        else;
        var scope = angular.element(document.getElementById("designer-controller")).scope();
        if (scope.$root.$$phase !== "$apply" && scope.$root.$$phase !== "$digest") scope.$apply();
        canvas.renderAll()
    });
    canvas.on("mouse:out", function(e) {
        canvas.renderAll()
    });
    canvas.on("mouse:up", function(e) {
        var scope = angular.element(document.getElementById("designer-controller")).scope()
    });
    canvas.on("path:created", function(e) {
        var scope = angular.element(document.getElementById("designer-controller")).scope(),
            index = scope.canvas.getObjects().length - 1;
        scope.addLayers(scope.canvas.item(index), scope.canvas.item(index).get("type"),
            index);
        showLayer();
        if (scope.$root.$$phase !== "$apply" && scope.$root.$$phase !== "$digest") scope.$apply()
    });
    canvas.on("object:selected", function(options) {
        var scope = angular.element(document.getElementById("designer-controller")).scope();
        var object = options.target;
        var thisItem = canvas.getObjects().indexOf(canvas.getActiveObject());
        var mobile = false;
        if ($(window).width() < 768) mobile = true;
        if (!mobile) showLayer();
        showConfig();
        canvas.getActiveObject().set({
            borderColor: "rgba(220, 220, 220, 1)",
            borderWidth: 10,
            hasRotatingPoint: false,
            cornerSize: 12,
            borderOpacityWhenMoving: 1,
            lockUniScaling: scope.lockProportion
        });
        scope.editableItem = thisItem;
        scope.editable.angle = object.angle;
        var angle = object.angle;
        if (object.angle > 360) angle = angle - 360;
        if (angle < 0) angle = angle + 360;
        angle = parseInt(angle);
        scope.editable.pattern = false;
        scope.editable.width = object.getWidth();
        scope.editable.height = object.getHeight();
        scope.currentLayerActive = thisItem;
        scope.editable.type = object.type;
        if (toType(object.getFill()) === "string") scope.editable.fill = object.getFill();
        else if (toType(object.getFill()) === "object") scope.editable.pattern = true;
        scope.editable.stroke = object.getStroke();
        scope.editable.strokeWidth = object.getStrokeWidth() * 20;
        if (object.type === "i-text" || object.type === "text" || object.type === "curvedText") {
            scope.showPopover("text");
            scope.editable.text = object.getText();
            scope.editable.textAlign = object.getTextAlign();
            scope.editable.fontFamily = object.get('fontName');
            $("#rotation-text").val(angle).trigger("change")
        }
        if(object.type === "curvedText" && NBDESIGNCONFIG['lang_rtl'] == 'rtl'){
            if(object.rtl) scope.editable.text = reverseString(object.getText());
        }
        if (object.type === "image" || object.type === "custom-image") {
            scope.showPopover("art");
            $("#rotation-image").val(angle).trigger("change");
            var opacity = object.get("opacity");
            $("#image_opacity").slider("value", 1 - opacity)
        }
        if (object.type === "rect" || object.type === "triangle" || object.type === "line" || object.type === "polygon" || object.type === "circle") {
            var opacity = object.get("opacity");
            $("#opacity_shape").slider("value", 1 - opacity);
            $("#rotation-shape").val(angle).trigger("change");
            scope.showPopover("draw");
            scope.shapeMode = true
        }
        if (object.type === "curvedText") scope.editable.effect = "block";
        else scope.editable.effect = "none";
        if (object.type === "path-group" || object.type === "path") {
            scope.showPopover("clipArt");
            var opacity = object.get("opacity");
            $("#rotation-svg").val(angle).trigger("change");
            $("#opacity_svg").slider("value", 1 - opacity)
        }
        if(typeof object.itemId === 'undefined') {
            var d = new Date();
            var itemId = d.getTime();             
            object.set({"itemId" : itemId})
        }
        scope.updatePositionReplaceButton();
        if (scope.$root.$$phase !== "$apply" && scope.$root.$$phase !== "$digest") scope.$apply();
        return
    });
    canvas.on("object:scaling", function(options) {
        var object = options.target;
        var scope = angular.element(document.getElementById("designer-controller")).scope();
        scope.editable.width = object.getWidth();
        scope.editable.height = object.getHeight();
        if (scope.$root.$$phase !== "$apply" && scope.$root.$$phase !== "$digest") scope.$apply()
    });
    canvas.on("object:moving", function(options) {
        var object = options.target;
        var grid = 10;
        var scope = angular.element(document.getElementById("designer-controller")).scope();        
        if(scope.gridMode){
            object.set({
                left: Math.round(object.left / grid) * grid,
                top: Math.round(object.top / grid) * grid
            });           
        }
        scope.updatePositionReplaceButton();
        if (scope.$root.$$phase !== "$apply" && scope.$root.$$phase !== "$digest") scope.$apply();
        return        
    });
    canvas.on("object:rotating", function(options) {
        var object = options.target;
        var scope = angular.element(document.getElementById("designer-controller")).scope();
        var thisItem = canvas.getObjects().indexOf(canvas.getActiveObject());
        var angle = object.angle;
        if (object.angle > 360) angle = angle - 360;
        if (angle < 0) angle = angle + 360;
        angle = parseInt(angle);        
        if (object.type === "i-text" || object.type === "text" || object.type === "curvedText") $("#rotation-text").val(angle).trigger("update");
        if (object.type === "image" || object.type === "custom-image") $("#rotation-image").val(angle).trigger("change");
        if (object.type === "rect" || object.type === "triagle" || object.type === "line" || object.type === "polygon" || object.type === "circle") $("#rotation-shape").val(angle).trigger("change");
        if (object.type === "path-group" || object.type === "path") $("#rotation-svg").val(angle).trigger("change")
    });
    canvas.on("object:modified", function(options) {
        var object = options.target;
        var scope = angular.element(document.getElementById("designer-controller")).scope();
        var thisItem = canvas.getObjects().indexOf(canvas.getActiveObject());
        scope.editableItem = thisItem;
        scope.canvas = canvas;
        var angle = object.angle;
        if (object.angle > 360) angle = angle - 360;
        if (angle < 0) angle = angle + 360;
        angle = parseInt(angle);
        scope.editable.angle = angle;
        if (object.type === "i-text" || object.type === "text" || object.type === "curvedText") {
            scope.editable.spacing = object.get("spacing");
            scope.editable.text = object.getText();
            $("#rotation-text").val(angle).trigger("change")
        }
        if(object.type === "curvedText" && NBDESIGNCONFIG['lang_rtl'] == 'rtl'){
            if(object.rtl) scope.editable.text = reverseString(object.getText());
        }        
        scope.editable.width = object.getWidth();
        scope.editable.height = object.getHeight();  
        if (object.type === "image" || object.type === "custom-image") $("#rotation-image").val(angle).trigger("change");
        if (object.type === "rect" || object.type === "triagle" || object.type === "line" || object.type === "polygon" || object.type === "circle") $("#rotation-shape").val(angle).trigger("change");
        if (object.type === "path-group" || object.type === "path") $("#rotation-svg").val(angle).trigger("change");
        scope.setUndoRedo({element: object, parameters: JSON.stringify(scope.currentItemParameters), interaction: 'modify'});
        scope.$apply();
        return
    });
    canvas.on("before:render", function() {
        var scope = angular.element(document.getElementById("designer-controller")).scope();
        scope.processing = 0;
        if (scope.$root.$$phase !== "$apply" && scope.$root.$$phase !== "$digest") scope.$apply()
    });
    canvas.on("after:render", function(e) {
        var scope = angular.element(document.getElementById("designer-controller")).scope();
        scope.processing = 100;
        if (scope.$root.$$phase !== "$apply" && scope.$root.$$phase !== "$digest") scope.$apply()
    });
    canvas2 = new fabric.Canvas("crop_canvas");
    canvas2.on("object:moving", function(options) {
        var object = options.target;
        ajustCropPath(object)
    });
    canvas2.on("object:rotating", function(options) {
        var object =
            options.target;
        ajustCropPath(object)
    });
    canvas2.on("object:scaling", function(options) {
        var object = options.target;
        ajustCropPath(object)
    });
    canvas2.on("object:modified", function(options) {
        var object = options.target;
        ajustCropPath(object)
    });
    canvas2.on("object:selected", function(options) {
        var object = options.target;
        ajustCropPath(object)
    });
    canvas2.on("path:created", function() {
        canvas2.isDrawingMode = false;
        var scope = angular.element(document.getElementById("designer-controller")).scope();
        var index = canvas2.getObjects().length;
        if (canvas2.item(2) && index > 3) canvas2.remove(canvas2.item(2));
        scope.currentPathCrop = canvas2.item(2).path;
        var object = canvas2.item(2);
        canvas2.item(2).set({
            centeredScaling: true,
            hasRotatingPoint: false
        });
        canvas2.item(2)["setControlVisible"]("tl", false);
        canvas2.item(2)["setControlVisible"]("bl", false);
        canvas2.setActiveObject(object);
        canvas2.renderAll();
        ajustCropPath(object);
        if (scope.$root.$$phase !== "$apply" && scope.$root.$$phase !== "$digest") scope.$apply()
    });
    function ajustCropPath(object) {
        var scope = angular.element(document.getElementById("designer-controller")).scope();
        var path = new fabric.Path(scope.currentPathCrop);
        var scaleX = object.get("scaleX"),
            ratio = canvas2.item(1).get("scaleX"),
            cv_witdth = canvas2.width,
            cv_height = canvas2.height,
            crop_width = object.get("width"),
            crop_height = object.get("height"),
            old_left = cv_witdth / 2 - crop_width / 2,
            old_top = cv_height / 2 - crop_height / 2,
            left = object.get("left") - crop_width / 2,
            top = object.get("top") - crop_height / 2;
        path.set({
            originX: "center",
            originY: "center",
            left: (object.get("left") - cv_witdth / 2) * 1 / ratio,
            top: (object.get("top") - cv_height / 2) * 1 / ratio,
            scaleX: 1 / ratio * scaleX,
            scaleY: 1 / ratio * scaleX,
            angle: object.angle,
            fill: "#9bf0e9",
            strokeWidth: 0,
            opacity: 0
        });
        canvas2.item(1).set({
            clipTo: function(ctx) {
                path.render(ctx)
            }
        });
        if (scope.$root.$$phase !== "$apply" && scope.$root.$$phase !== "$digest") scope.$apply()
    }
    angular.module("app", ["LocalStorageModule", "angularFileUpload", "imgpreload", "angularSpectrumColorpicker"]).constant("_", window._).config(function(localStorageServiceProvider) {
        localStorageServiceProvider.prefix = "nbdesigner"
    })
})();
/**
 * List path mark
 * @for function crop image
 * @type array conatain SVG path
 */
var listPath = {
    "path_mark": "M1.398,84.129c3.305,20.461,9.73,50.635,13.591,67.385c2.354,10.212,12.549,23.734,18.51,30.02c4.923,5.191,27.513,23.343,38.34,27.589c18.604,7.295,33.984,4.187,46.012-8.306c12.028-12.493,25.595-34.78,27.954-43.994c2.587-10.105,5.065-26.842,4.313-37.243c-1.036-14.316-14.224-69.332-16.806-79.55c-4.48-17.735-26.246-48.821-80.609-37.668C-1.66,13.514-1.879,63.844,1.398,84.129z",
    "path_crop": "M0 0 L0 100 L100 100 L100 0Z",
    "path_1": "M 12 0 l 2.139 2.629 l 3.068 -1.441 l 0.786 3.297 l 3.389 0.033 l -0.722 3.312 l 3.039 1.5 l -2.088 2.67 l 2.088 2.67 l -3.039 1.5 l 0.722 3.312 l -3.389 0.033 l -0.786 3.297 l -3.068 -1.441 l -2.139 2.629 l -2.139 -2.629 l -3.068 1.441 l -0.786 -3.297 l -3.389 -0.033 l 0.722 -3.312 l -3.039 -1.5 l 2.088 -2.67 l -2.088 -2.67 l 3.039 -1.5 l -0.722 -3.312 l 3.389 -0.033 l 0.786 -3.297 l 3.068 1.441 Z",
    "path_2": "M 0.054 23 c 0.971 -1.912 2.048 -4.538 1.993 -6.368 c -1.308 -1.562 -2.047 -3.575 -2.047 -5.625 c 0 -5.781 5.662 -10.007 12 -10.007 c 6.299 0 12 4.195 12 10.007 c 0 6.052 -6.732 11.705 -15.968 9.458 c -1.678 1.027 -5.377 2.065 -7.978 2.535 Z",
    "path_3": "M-12,0a12,12 0 1,0 24,0a12,12 0 1,0 -24,0",
    "path_4": "M 9 0 c -5 0 -9 7 -9 14 c 0 5 3 10 9 10 c 6 0 9 -5 9 -10 c 0 -7 -4 -14 -9 -14 Z",
    "path_5": "M 12 4.248 c -3.148 -5.402 -12 -3.825 -12 2.944 c 0 4.661 5.571 9.427 12 15.808 c 6.43 -6.381 12 -11.147 12 -15.808 c 0 -6.792 -8.875 -8.306 -12 -2.944 Z",
    "path_6": "M 18 1 l -6 4 l -6 -4 l -6 5 v 7 l 12 10 l 12 -10 v -7 Z",
    "path_7": "M 24 16.971 l -7.029 7.029 h -9.942 l -7.029 -7.029 v -9.942 l 7.029 -7.029 h 9.942 l 7.029 7.029 Z",
    "path_8": "M 12 0 c -2.995 2.995 -7.486 4 -11 4 c 0 8.583 5.068 16.097 11 20 c 5.932 -3.903 11 -11.417 11 -20 c -3.514 0 -8.005 -1.005 -11 -4 Z",
    "path_9": "M 1 4 c 0 8.578 5.071 16.1 11 20 c 5.929 -3.9 11 -11.422 11 -20 c -2.828 -2.329 -7.153 -4 -11 -4 c -3.838 0 -8.172 1.671 -11 4 Z",
    "path_10": "M 12 0.587 l 3.668 7.568 l 8.332 1.151 l -6.064 5.828 l 1.48 8.279 l -7.416 -3.967 l -7.417 3.967 l 1.481 -8.279 l -6.064 -5.828 l 8.332 -1.151 Z",
    "path_11": "M 0.000 16.000 L 12.000 20.785 L 13.856 8.000 L 24.000 0.000 L 13.856 -8.000 L 12.000 -20.785 L 0.000 -16.000 L -12.000 -20.785 L -13.856 -8.000 L -24.000 0.000 L -13.856 8.000 L -12.000 20.785 z",
    "path_12": "M10,10 h20 a2,2 0 0 0.1 2,2 v20 a2,2 0 0 0.1 -2,2 h-20 a2,2 0 0 0.1 -2,-2 v-20 a2,2 0 0 0.1 2,-2 z",
    "path_13": "M0 0 L24 0 L12 20.78z"
};
"use strict";
var topLeftImage = new Image;
topLeftImage.src = od_mainURL + "images/fa_times.png";
var topRightImage = new Image;
topRightImage.src = od_mainURL + "images/fa_rotate.png";
var bottomRightImage = new Image;
bottomRightImage.src = od_mainURL + "images/fa_resize.png";
var bottomLeftImage = new Image;
bottomLeftImage.src = od_mainURL + "images/fa_layers.png";
function isVML() {
    return typeof G_vmlCanvasManager !== "undefined"
}
fabric.Object.prototype._drawControl = function(control, ctx, methodName, left, top) {
    var size = this.cornerSize;
    if (this.isControlVisible(control)) {
        isVML() || this.transparentCorners || ctx.clearRect(left, top, size, size);
        ctx.strokeStyle = "rgba(220, 220, 220, 1)";
        ctx.lineWidth = 1;
        if (control == "tl") {
            ctx.drawImage(topLeftImage, left, top, size, size);
            ctx.strokeRect(left, top, size, size)
        } else if (control == "tr") {
            ctx.drawImage(topRightImage, left, top, size, size);
            ctx.strokeRect(left, top, size, size)
        } else if (control == "bl") {
            ctx.drawImage(bottomLeftImage,
                left, top, size, size);
            ctx.strokeRect(left, top, size, size)
        } else if (control == "br") {
            ctx.drawImage(bottomRightImage, left, top, size, size);
            ctx.strokeRect(left, top, size, size)
        } else;
    }
};
fabric.Canvas.prototype._getActionFromCorner = function(target, corner) {
    var action = "drag";
    if (corner) {
        action = corner === "ml" || corner === "mr" ? "scaleX" : corner === "mt" || corner === "mb" ? "scaleY" : corner === "tl" ? "rotate" : "scale";
        if (corner == "tr") action = "rotate";
        if (corner == "tl") {
            action = "delete";
            deleteObject()
        }
        if (corner == "bl") {
            action = "layer";
            var scope = angular.element(document.getElementById("designer-controller")).scope();
            scope.duplicateItem();
            if (scope.$root.$$phase !== "$apply" && scope.$root.$$phase !== "$digest") scope.$apply()
        }
    }
    return action
};
function deleteObject(index) {
    $.confirm({
        text: langjs["DELETE_ITEM_MESSAGE"],
        confirm: function() {
            var scope = angular.element(document.getElementById("designer-controller")).scope();
            if (index == null) {
                scope.setUndoRedo({
                    element: scope.canvas.getActiveObject(),
                    parameters: scope.getItemJson(scope.canvas.getActiveObject()),
                    interaction: 'remove'
                });      
                scope.canvas.remove(scope.canvas.getActiveObject());
                scope.editableItem = null;                
                scope.closePopover()
            } else {      
                scope.setUndoRedo({
                    element: scope.canvas.item(index),
                    parameters: scope.getItemJson(scope.canvas.item(index)),
                    interaction: 'remove'
                });       
                scope.canvas.remove(scope.canvas.item(index));
            }         
            scope.drawCanvas();
            scope.saveDesign();
            scope.updateCurrentLayerAfterDelete();
            if (scope.$root.$$phase !== "$apply" && scope.$root.$$phase !== "$digest") scope.$apply()
        },
        cancel: function() {}
    })
}
function deleteAllObject() {
    $.confirm({
        text: langjs["DELETE_ALL_ITEM_MESSAGE"],
        confirm: function() {
            var scope = angular.element(document.getElementById("designer-controller")).scope();
            scope.canvas.clear();
            scope.closePopover();
            scope.updateCurrentLayerAfterDelete();
            scope.clearHistory();
            if ($("#gesture .menu_gesture").hasClass("open")) $("#gesture .menu_gesture .m-center").triggerHandler("click");
            if ($("#layer").hasClass("open")) $("#layer").triggerHandler("click");
            if (scope.$root.$$phase !== "$apply" && scope.$root.$$phase !==
                "$digest") scope.$apply()
        },
        cancel: function() {}
    })
}
fabric.Canvas.prototype._handleCursorAndEvent = function(e, target) {
    this._setCursorFromEvent(e, target);
    var _this = this;
    setTimeout(function() {
        _this._setCursorFromEvent(e, target)
    }, 50);
    this.fire("mouse:up", {
        target: target,
        e: e
    });
    target && target.fire("mouseup", {
        e: e
    })
};
fabric.Canvas.prototype._getRotatedCornerCursor = function(corner, target) {
    var cursorOffset = {
        mt: 0,
        tr: 1,
        mr: 2,
        br: 3,
        mb: 4,
        bl: 5,
        ml: 6,
        tl: 7
    };
    if (corner == "tr") return "copy";
    if (corner == "tl") return "pointer";
    if (corner == "bl") return "cell";
    var n = Math.round(target.getAngle() % 360 / 45);
    if (n < 0) n += 8;
    n += cursorOffset[corner];
    n %= 8;
    return this.cursorMap[n]
};
fabric.CustomImage = fabric.util.createClass(fabric.Image, {
    type: "custom-image",
    initialize: function(element, options) {
        this.callSuper("initialize", element, options);
        options && this.set("origin_src", options.origin_src)
    },
    toObject: function() {
        return fabric.util.object.extend(this.callSuper("toObject"), {
            "origin_src": this.origin_src
        })
    }
});
fabric.CustomImage.fromObject = function(object, callback) {
    fabric.util.loadImage(object.src, function(img) {
        callback && callback(new fabric.CustomImage(img, object))
    })
};
fabric.CustomImage.async = true;

function addFontFaceToFaric(name, type, url) {
    var font = name.replace(/\s/g, "+");
    if (type == "google") fabric.googleFonts[font] = "https://fonts.googleapis.com/css?family=" + font;
    else {
        base64 = base64Encode(getBinary(url));
        console.log(base64);
        fabric.fontPaths[font] = base64
    }
}
var _window = {
    "width": 500,
    "height": 500
};
function calcCanvasWidth() {
    var w = $(window).width();
    var h = $(window).height();
    //console.log(w);
    if (w > h - 120) _window.width = h - 120;
    else _window.width = w;
    return _window.width
}
function reverseString(s) {
  return s.split('').reverse().join('');
}
var itemConfig = {
    'clickToUpload' : false,
    'rtl' : false,
    'lockMovementX' : false,
    'lockMovementY' : false,
    'lockScalingX' : false,
    'lockScalingY' : false,
    'lockRotation' : false
};
var app = angular.module("imgpreload", []);
$(window.parent).on("resize", function() {
    var scope = angular.element(document.getElementById("designer-controller")).scope();
    scope.resetDimension();
    if (scope.$root.$$phase !== "$apply" && scope.$root.$$phase !== "$digest") scope.$apply()
});
app.directive("spinnerOnLoad", function() {
    return {
        restrict: "A",
        link: function(scope, element) {
            element.on("load", function() {
                element.removeClass("spinner-hide");
                element.addClass("spinner-show");
                element.parent().removeAttr("width");
                element.parent().find("span").remove()
            });
            scope.$watch("ngSrc", function() {
                element.addClass("spinner-hide");
                element.parent().append('<span class="spinner"></span>')
            })
        }
    }
}).directive("fontOnLoad", function() {
    return {
        restrict: "A",
        link: function(scope, element) {
            var start = setInterval(function() {
                var font =
                    element.find(".nbdesigner_font_name").data("font");
                if (isFontAvailable(font)) {
                    element.find(".spinner").remove();
                    element.removeAttr("width");
                    element.css("opacity", 1);
                    clearInterval(start)
                }
            }, 100);
            var to = setTimeout(function() {
                var font = element.find(".nbdesigner_font_name").data("font");
                if (isFontAvailable(font)) clearInterval(to);
                if (!isFontAvailable(font)) {
                    clearInterval(start);
                    element.remove()
                }
            }, 5E3);
            element.append('<span class="spinner"></span>')
        }
    }
});
angular.module("app").controller("DesignerController", function($scope, PatternService, ProductService, localStorageService, FontService, ArtService, QrcodeService, $interval, $upload, $timeout, LanguageService, AdminTemplateService) {
    $scope.canvas = null;
    $scope.designerWidth = calcCanvasWidth();
    $scope.designerHeight = calcCanvasWidth();
    $scope.modeMobile = false;
    var w = $(window).width();
    if (w < 768) $scope.modeMobile = true;
    $scope.offset = w / 2 - $scope.designerWidth / 2;
    $scope.editableItem = null;
    $scope.editableObject = null;
    $scope.currentVariant = {};
    $scope.currentVariant.info = {};
    $scope.varaints = {};
    $scope.varaints.frames = {};
    $scope.varaints.areaDesign = {};
    $scope.varaints.areaParams = {};
    $scope.currentVariant.orientationActive = "frame_0";
    $scope.currentVariant.orientationBefore = "frame_0";
    $scope.currentVariant.index = 0;
    $scope.layers = {};
    $scope.currentLayers = [];
    $scope.currentLayerActive = 1;
    $scope.currentColor = "FFFFFF";
    $scope.editMode = "none";
    $scope.borderColor = "#000000";
    $scope.colorOptional = NBDESIGNCONFIG['nbdesigner_default_color'].substr(1, 7);
    $scope.colorStrokeOptional = NBDESIGNCONFIG['nbdesigner_default_color'].substr(1, 7);
    $scope.background = NBDESIGNCONFIG['nbdesigner_default_color'].substr(1, 7);
    $scope.lockProportion = true;
    $scope.lineHeight = 1;
    $scope.fontSize = 30;
    $scope.loaded = 0;
    $scope.shadow = {};
    $scope.shadow.x = 0;
    $scope.shadow.y = 0;
    $scope.shadow.blur = 0;
    $scope.shadow.alpha = 1;
    $scope.shadow.color = NBDESIGNCONFIG['nbdesigner_default_color'].substr(1, 7);
    $scope.loaded = 0;
    $scope.zoom = 1;
    $scope.settings = {};
    $scope.Popover = "none";
    $scope.currentFont = {};
    $scope.currentFont.name = "Arial";
    $scope.pop = {};
    $scope.pop.type = "";
    $scope.pop.text = "none";
    $scope.pop.art = "none";
    $scope.pop.clipArt = "none";
    $scope.pop.qrcode = "none";
    $scope.pop.draw = "none";
    $scope.canvases = {};
    $scope.undos = {};
    $scope.redos = {};
    $scope.dataCustomerDesign = {};
    $scope.editable = {};
    $scope._ = _;
    $scope.uploadURL = [];
    $scope.file = [];
    $scope.loading = false;
    $scope.currentCateFont = langjs['FONT_CAT'];
    $scope.contentText = "Text Here";
    $scope.designScale = calcCanvasWidth() / NBDESIGNCONFIG['stage_dimension'];
    $scope.scale = {};
    $scope.rateConvertCm2Px = 37.8;
    $scope.currentScale = "1";
    $scope.iid = "images";
    $scope.qrCodeContent = NBDESIGNCONFIG['default_text_qrcode'];
    $scope.imgPageSize = 10;
    $scope.artPageSize = 10;
    $scope.artPageSizes = [];
    $scope.imgCurrentPage = 0;
    $scope.artCat = [];
    $scope.arts = [];
    $scope.curentCatArt = "0";
    $scope.currentCatArtName = langjs['CAT'];
    $scope.editable.paths = [];
    $scope.pathColor = [];
    $scope.countArt = 0;
    $scope.fontPageSize = 10;
    $scope.fontPageSizes = [];
    $scope.fontCat = [];
    $scope.fonts = [];
    $scope.AllFonts = [];
    $scope.google_font = [];
    $scope.googleFont = [];
    $scope.customFont = [];
    $scope.googleFontPageSize = 10;
    $scope.adminTemplatePageSize = 8;
    $scope.curentCatFont = "0";
    $scope.currentCatFontName = langjs['CAT'];
    $scope.countFont = 0;
    $scope.enableGroup = false;
    $scope.colorBrush = NBDESIGNCONFIG['nbdesigner_default_color'].substr(1, 7);
    $scope.brushShadowWidth = 1;
    $scope.brushWidth = 1;
    $scope.brushOpacity = 1;
    $scope.brushAngle = 0;
    $scope.colorShape = NBDESIGNCONFIG['nbdesigner_default_color'].substr(1, 7);
    $scope.shapeMode = false;
    $scope.currentPreview = od_mainURL + "images/default.png";
    $scope.processing = 100;
    $scope.currentPathCrop = listPath.path_crop;
    $scope.patterns = [];
    $scope.patternPageSize = 10;
    $scope.imageFromUrl = "";
    $scope.fontCollection = {};
    $scope.currentFontCollection = [];
    $scope.ajustmentScale = 1;
    $scope.ajustmentOrientationScale = [];
    $scope.flagChangeOrientation = [];
    $scope.ignoreLocalDesign = false;
    $scope.adminListTemplate = [];
    $scope.backgroundId = 0;
    $scope.statusWebcam = false;
    $scope.onLoadProduct = false;
    $scope.rtlLang = false;
    $scope.langMode = NBDESIGNCONFIG['lang_rtl'];
    $scope.refProduct = [];
    $scope.showAlignToolbar = false;
    $scope.holdShiftKey = false;
    $scope.gridMode = false;
    $scope.task = OD_task;
    $scope.orientationActiveUndoStatus = false;
    $scope.orientationActiveRedoStatus = false;
    $scope.currentItemParameters = {};
    $scope.readyReplaceImage = false;
    $scope.partialSave = false;
    $scope.uiLayout = [];
    $scope.colorPalette = colorPalette;
    $scope.resetDimension = function() {
        $scope.designerWidth = calcCanvasWidth();
        $scope.designerHeight = calcCanvasWidth();
        $scope.modeMobile = false;
        var oldScale = $scope.designScale;
        $scope.designScale = calcCanvasWidth() / NBDESIGNCONFIG['stage_dimension'];
        var w = $(window).width();
        if (w < 768) $scope.modeMobile = true;
        $scope.offset = w / 2 - $scope.designerWidth / 2;
        $scope.zoomCanvas();
        var orientation =  $scope.currentVariant.orientationActive,
        index = orientation.substring(6);
        $scope.ajustmentOrientationScale[index] = $scope.designScale;
        $scope.resizeDesign($scope.designScale, oldScale);
    };
    $scope.ajustAfterAddItem = function(type) {
        var d = new Date();
        var itemId = d.getTime();         
        var index = $scope.canvas.getObjects().length - 1;
        $scope.canvas.setActiveObject($scope.canvas.item(index));
        $scope.canvas.item($scope.editableItem).centerH();
        $scope.canvas.item($scope.editableItem).centerV();
        $scope.canvas.item($scope.editableItem).setCoords();
        $scope.canvas.item($scope.editableItem).set({"itemId" : itemId});
        $scope.drawCanvas();
        $scope.setUndoRedo({
            element: $scope.canvas.item(index),
            parameters: $scope.getItemJson($scope.canvas.item(index)),
            interaction: "add"
        });         
        $scope.addLayers($scope.canvas.getActiveObject(), type, index);
    };
    $scope.setItemConfig = function(item, prop, value){
        if(!!item.configuration){
            var config = item.configuration;
            if(config.hasOwnProperty(prop)){
                config[prop] = value;
                item.configuration = config
            }else {
                var con = {};
                con[prop] = value;
                item.configuration = _.merge(config, con);
            }
        }else {
            var config = {};
            config[prop] = value;
            item.configuration = config
        }
    };
    $scope.getItemConfig = function(item, prop){
        if(!!item.configuration){
            var config = item.configuration;
            if(config.hasOwnProperty(prop)){
                return config[prop];
            }else{
                return false;
            }
        }else{
            return false;
        }
    };
    $scope.addText = function() {
        $scope.disableDrawMode();
        $scope.showPopover("text");
        $scope.zoom = 1;
        $scope.zoomCanvas();      
        var text = new fabric.Text($scope.settings.default_text, {
            left: 100,
            top: 10,
            fill: NBDESIGNCONFIG['nbdesigner_default_color'],
            fontFamily: "Arial",
            radius: 50,
            fontSize: 30,
            textAlign: "center",
            spacing: 0
        });
        $scope.canvas.add(text);
        $scope.ajustAfterAddItem("text");
    };
    $scope.ChangeText = function() {
        if ($scope.editableItem == null) return;
        $scope.canvas.item($scope.editableItem).setText($scope.editable.text);
        var type = $scope.canvas.item($scope.editableItem).get("type");
        $scope.addLayers($scope.canvas.item($scope.editableItem), type, $scope.editableItem);
        $scope.drawCanvas();
    };
    $scope.changeFont = function(font) {
        if ($scope.editableItem == null) return;
        var stop = $interval(function() {
            var name = "";
            if (font.alias) name = font.alias;
            else name = font.name;
            if (isFontAvailable(name)) {
                $scope.setUndoRedo({
                    element:  $scope.canvas.item($scope.editableItem), 
                    parameters: JSON.stringify({"fontFamily" : $scope.canvas.item($scope.editableItem).fontFamily}), 
                    interaction: 'modify'
                });                  
                $scope.currentFont = font;
                $scope.canvas.item($scope.editableItem).setFontFamily(name);
                $scope.canvas.item($scope.editableItem).set("fontName", name);
                var index = $scope.canvas.getObjects().length - 1;
                $scope.canvas.setActiveObject($scope.canvas.item($scope.editableItem));
                $scope.canvas.item($scope.editableItem).setCoords();
                $scope.drawCanvas();
                $interval.cancel(stop);
            }
        }, 100);
        $scope.currentFontCollection[$scope.editableItem] = font;
        jQuery("#dg-fonts").modal("hide");
    };
    $scope.addTeam = function() {
        $scope.showPopover("team");
    };
    $scope.closePopover = function() {
        $scope.Popover = "none";
    };
    $scope.showPopover = function(type) {
        $scope.pop.type = type;
        $scope.pop.text = "none";
        $scope.pop.art = "none";
        $scope.pop.qrcode = "none";
        $scope.pop.clipArt = "none";
        $scope.pop.draw = "none";
        $scope.Popover = "block";
        switch (type) {
            case "text":
                $scope.pop.text = "block";
                break;
            case "art":
                $scope.pop.art = "block";
                break;
            case "qrcode":
                $scope.pop.qrcode =
                    "block";
                break;
            case "clipArt":
                $scope.pop.clipArt = "block";
                break;
            case "draw":
                $scope.pop.draw = "block";
                break;
            default:
                $scope.pop.text = "none";
                $scope.pop.art = "none";
                $scope.pop.qrcode = "none";
                $scope.pop.clipArt = "none";
                $scope.pop.draw = "none"
        }
    };
    $scope.drawCanvas = function() {
        $scope.canvas.calcOffset();       
        $scope.canvas.renderAll()
    };
    $scope.changeColor = function(e) {
        if ($scope.editableItem == null) return;
        $scope.setUndoRedo({
            element:  $scope.canvas.item($scope.editableItem), 
            parameters: JSON.stringify({"fill" : $scope.editable.fill}), 
            interaction: 'modify'
        });
        var color = tinycolor(e).toHexString();
        $scope.canvas.item($scope.editableItem).setFill(color);
        $scope.editable.fill = color;        
        $scope.drawCanvas()
    };
    $scope.changeStroke = function(c, stroke) {
        if ($scope.editableItem == null) return;
        $scope.setUndoRedo({
            element:  $scope.canvas.item($scope.editableItem), 
            parameters: JSON.stringify({"stroke" : $scope.editable.stroke}), 
            interaction: 'modify'
        });        
        if (c) {
            var color = "#" + c;
            if(c.charAt(0) == "r" || c.charAt(0) == "#") color = c;
            $scope.editable.stroke = color;
            $scope.canvas.item($scope.editableItem).setStroke($scope.editable.stroke)
        }
        if (stroke) $scope.canvas.item($scope.editableItem).setStrokeWidth(stroke);
        $scope.drawCanvas();
    };
    $scope.toggleItalic = function() {
        if ($scope.editableItem == null) return;
        $scope.setUndoRedo({
            element:  $scope.canvas.item($scope.editableItem), 
            parameters: JSON.stringify({"fontStyle" : $scope.canvas.item($scope.editableItem).fontStyle}), 
            interaction: 'modify'
        });         
        if ($scope.editable.italic) {
            $scope.editable.italic = false;
            $scope.canvas.item($scope.editableItem).setFontStyle("normal");
        } else {
            $scope.editable.italic = true;
            $scope.canvas.item($scope.editableItem).setFontStyle("italic");
        }
        $scope.drawCanvas();
    };
    $scope.toggleBold = function() {
        if ($scope.editableItem == null) return;
        $scope.setUndoRedo({
            element:  $scope.canvas.item($scope.editableItem), 
            parameters: JSON.stringify({"fontWeight" : $scope.canvas.item($scope.editableItem).fontWeight}), 
            interaction: 'modify'
        });            
        if ($scope.editable.bold) {
            $scope.editable.bold = false;
            $scope.canvas.item($scope.editableItem).setFontWeight("normal")
        } else {
            $scope.editable.bold = true;
            $scope.canvas.item($scope.editableItem).setFontWeight("bold")
        }
        $scope.drawCanvas()
    };
    $scope.toggleTextDecoration = function(decoration) {
        if ($scope.editableItem == null) return;
        $scope.setUndoRedo({
            element:  $scope.canvas.item($scope.editableItem), 
            parameters: JSON.stringify({"textDecoration" : $scope.canvas.item($scope.editableItem).textDecoration}), 
            interaction: 'modify'
        });           
        if ($scope.editable.textDecoration == decoration) {
            $scope.editable.textDecoration = "";
            $scope.canvas.item($scope.editableItem).setTextDecoration("")
        } else {
            $scope.editable.textDecoration =
                decoration;
            $scope.canvas.item($scope.editableItem).setTextDecoration(decoration)
        }
        $scope.drawCanvas()
    };
    $scope.changeShadow = function() {
        if ($scope.editableItem == null) return;
        var color = {"r" : 0, "g" : 0 , "b" : 0};
        if($scope.shadow.color.charAt(0) == "r" || $scope.shadow.color.charAt(0) == "#"){
            color = tinycolor($scope.shadow.color).toRgb();
        }else {
            color = hexToRGB("#" + $scope.shadow.color);
        }
        var shadow = "rgba(" + color.r + ", " + color.g + ", " + color.b + ", " + $scope.shadow.alpha + ") " + $scope.shadow.x + "px " + $scope.shadow.y + "px " + $scope.shadow.blur + "px";
        $scope.canvas.item($scope.editableItem).setShadow(shadow);
        $scope.drawCanvas()
    };
    $scope.removeShadow = function() {
        if ($scope.editableItem == null) return;
        $scope.canvas.item($scope.editableItem).setShadow("");
        $scope.drawCanvas()
    };
    $scope.flipHorizontal = function() {
        var obj = $scope.canvas.getActiveObject();
        if (obj == null) return;
        $scope.setUndoRedo({
            element:  $scope.canvas.item($scope.editableItem), 
            parameters: JSON.stringify({"flipY" : $scope.canvas.item($scope.editableItem).flipY}), 
            interaction: 'modify'
        });          
        $scope.canvas.item($scope.editableItem).toggle("flipY");
        $scope.canvas.item($scope.editableItem).setCoords();
        $scope.drawCanvas()
    };
    $scope.flipVertical = function() {
        var obj = $scope.canvas.getActiveObject();
        if (obj == null) return;
        $scope.setUndoRedo({
            element:  $scope.canvas.item($scope.editableItem), 
            parameters: JSON.stringify({"flipX" : $scope.canvas.item($scope.editableItem).flipX}), 
            interaction: 'modify'
        });           
        $scope.canvas.item($scope.editableItem).toggle("flipX");
        $scope.canvas.item($scope.editableItem).setCoords();
        $scope.drawCanvas()
    };
    $scope.setHorizontalCenter = function() {
        var obj = $scope.canvas.getActiveObject();
        if (obj == null) return;
        $scope.canvas.item($scope.editableItem).centerH();
        $scope.canvas.item($scope.editableItem).setCoords();
        $scope.drawCanvas()
    };
    $scope.setVerticalCenter = function() {
        var obj = $scope.canvas.getActiveObject();
        if (obj == null) return;
        $scope.canvas.item($scope.editableItem).centerV();
        $scope.canvas.item($scope.editableItem).setCoords();
        $scope.drawCanvas()
    };
    $scope.ShiftLeft = function() {
        var obj = $scope.canvas.getActiveObject();
        if (obj == null) return;
        $scope.setUndoRedo({
            element:  $scope.canvas.item($scope.editableItem), 
            parameters: JSON.stringify({"left" : $scope.canvas.item($scope.editableItem).left}), 
            interaction: 'modify'
        });          
        var width = $scope.canvas.width / 100;
        var left = $scope.canvas.item($scope.editableItem).left;
        $scope.canvas.item($scope.editableItem).set("left", left - width);
        $scope.canvas.item($scope.editableItem).setCoords();
        $scope.drawCanvas()
    };
    $scope.ShiftRight = function() {
        var obj = $scope.canvas.getActiveObject();
        if (obj == null) return;
        $scope.setUndoRedo({
            element:  $scope.canvas.item($scope.editableItem), 
            parameters: JSON.stringify({"left" : $scope.canvas.item($scope.editableItem).left}), 
            interaction: 'modify'
        });          
        var width = $scope.canvas.width / 100;
        var left = $scope.canvas.item($scope.editableItem).left;
        $scope.canvas.item($scope.editableItem).set("left", left + width);
        $scope.canvas.item($scope.editableItem).setCoords();
        $scope.drawCanvas()
    };
    $scope.ShiftUp = function() {
        var obj = $scope.canvas.getActiveObject();
        if (obj == null) return;
        $scope.setUndoRedo({
            element:  $scope.canvas.item($scope.editableItem), 
            parameters: JSON.stringify({"top" : $scope.canvas.item($scope.editableItem).top}), 
            interaction: 'modify'
        });          
        var height = $scope.canvas.height / 100;
        var top = $scope.canvas.item($scope.editableItem).top;
        $scope.canvas.item($scope.editableItem).set("top", top - height);
        $scope.canvas.item($scope.editableItem).setCoords();
        $scope.drawCanvas()
    };
    $scope.ShiftDown = function() {
        var obj = $scope.canvas.getActiveObject();
        if (obj == null) return;
        $scope.setUndoRedo({
            element:  $scope.canvas.item($scope.editableItem), 
            parameters: JSON.stringify({"top" : $scope.canvas.item($scope.editableItem).top}), 
            interaction: 'modify'
        });         
        var height = $scope.canvas.height / 100;
        var top = $scope.canvas.item($scope.editableItem).top;
        $scope.canvas.item($scope.editableItem).set("top", top + height);
        $scope.canvas.item($scope.editableItem).setCoords();
        $scope.drawCanvas()
    };
    $scope.alignGroupLeft = function(){
        if($scope.canvas.getActiveGroup === null) return;
        var arr = [];
        $scope.canvas.getActiveGroup().forEachObject(function(obj) {
            arr.push(obj.get("left"));
        });        
        var val = _.min(arr);
        $scope.canvas.getActiveGroup().forEachObject(function(obj) {
            obj.set({"left" : val});
            obj.setCoords();
        });  
        $scope.drawCanvas()
    };
    $scope.alignGroupTop = function(){
        if($scope.canvas.getActiveGroup === null) return;
        var arr = [];
        $scope.canvas.getActiveGroup().forEachObject(function(obj) {
            arr.push(obj.get("top"));
        });        
        var val = _.min(arr);
        $scope.canvas.getActiveGroup().forEachObject(function(obj) {
            obj.set({"top" : val});
            obj.setCoords();
        });  
        $scope.drawCanvas()
    };  
    $scope.alignGroupRight = function(){
        if($scope.canvas.getActiveGroup === null) return;
        var arr = [];
        $scope.canvas.getActiveGroup().forEachObject(function(obj) {
            var left = obj.get("left");
            var width = obj.get("scaleX") * obj.get("width");
            arr.push(left + width);
        });        
        var val = _.max(arr);
        $scope.canvas.getActiveGroup().forEachObject(function(obj) {
            var left = val - obj.get("scaleX") * obj.get("width");
            obj.set({"left" : left});
            obj.setCoords();
        });  
        $scope.drawCanvas()
    };   
    $scope.alignGroupBottom = function(){
        if($scope.canvas.getActiveGroup === null) return;
        var arr = [];
        $scope.canvas.getActiveGroup().forEachObject(function(obj) {
            var left = obj.get("top");
            var width = obj.get("scaleY") * obj.get("height");
            arr.push(left + width);
        });        
        var val = _.max(arr);
        $scope.canvas.getActiveGroup().forEachObject(function(obj) {
            var top = val - obj.get("scaleY") * obj.get("height");
            obj.set({"top" : top});
            obj.setCoords();
        });  
        $scope.drawCanvas()
    };  
    $scope.alignGroupVer = function(){
        if($scope.canvas.getActiveGroup === null) return;
        //var hafl_width = $scope.currentVariant.designArea['area_design_width'] * $scope.zoom * $scope.designScale / 2;      
        var arr = [];
        $scope.canvas.getActiveGroup().forEachObject(function(obj, index) {
            var left = obj.get("left");
            var width = obj.get("scaleX") * obj.get("width") / 2;
            arr.push(left + width);
        });  
        var val = _.min(arr);
        $scope.canvas.getActiveGroup().forEachObject(function(obj) {
            var left = val - obj.get("scaleX") * obj.get("width") / 2;
            obj.set({"left" : left});    
            obj.setCoords();
        });
        $scope.canvas.getActiveGroup().setObjectsCoords();
        $scope.drawCanvas()
    };
    $scope.alignGroupHor = function(){
        if($scope.canvas.getActiveGroup === null) return;
        var arr = [];
        $scope.canvas.getActiveGroup().forEachObject(function(obj) {
            var left = obj.get("top");
            var width = obj.get("scaleY") * obj.get("height") / 2;
            arr.push(left + width);
        });        
        var val = _.min(arr);
        $scope.canvas.getActiveGroup().forEachObject(function(obj) {
            var top = val - obj.get("scaleY") * obj.get("height") / 2;
            obj.set({"top" : top});
            obj.setCoords();
        });  
        $scope.drawCanvas()     
    };    
    $scope.deactiveGroup = function(){
        $scope.canvas.deactivateAll().renderAll();
        $scope.showAlignToolbar = false;
    };
    $scope.unlockProportion = function() {
        if ($scope.editableItem == null) return;
        $scope.canvas.setActiveObject($scope.canvas.item($scope.editableItem));
        $scope.drawCanvas()
    };
    $scope.rotateText = function(angle) {
        if ($scope.editableItem == null) return;
        if (!!angle) {
            if (angle > 360) angle = angle - 360;
            if (angle < 0) angle = angle + 360;
            $scope.canvas.item($scope.editableItem).setAngle(angle);
            $scope.drawCanvas()
        } else {
            $scope.canvas.item($scope.editableItem).setAngle(0);
            $scope.drawCanvas()
        }
    };
    $scope.deleteAllItem = function() {
        deleteAllObject();
        $scope.drawCanvas()
    };
    $scope.align = function(layout) {
        if ($scope.editableItem == null) return;
        $scope.setUndoRedo({
            element:  $scope.canvas.item($scope.editableItem), 
            parameters: JSON.stringify({"textAlign" : $scope.canvas.item($scope.editableItem).textAlign}), 
            interaction: 'modify'
        });         
        $scope.editable.textAlign = layout;
        $scope.canvas.item($scope.editableItem).setTextAlign(layout);
        $scope.drawCanvas()
    };
    $scope.setOpacity = function(value) {
        if ($scope.editableItem == null) return;
        var value = 1 - value;
        $scope.canvas.item($scope.editableItem).set({
            opacity: value
        });
        $scope.drawCanvas()
    };
    $scope.setBackground = function(e) {
        if ($scope.editableItem == null) return;
        $scope.setUndoRedo({
            element:  $scope.canvas.item($scope.editableItem), 
            parameters: JSON.stringify({"textBackgroundColor" : $scope.canvas.item($scope.editableItem).getTextBackgroundColor()}), 
            interaction: 'modify'
        });	        
        if (!e){
            var color = $scope.background;
            color = tinycolor(color).toHexString();
            $scope.canvas.item($scope.editableItem).setTextBackgroundColor(color);
        }else {
            $scope.canvas.item($scope.editableItem).setTextBackgroundColor("");
        }
        $scope.drawCanvas()
    };
    $scope.setLineHeight = function() {
        if ($scope.editableItem == null) return;
        $scope.canvas.item($scope.editableItem).setLineHeight($scope.lineHeight);
        $scope.drawCanvas()
    };
    $scope.changeCurve = function(val) {
        if ($scope.editableItem == null) return;
        var index = $scope.editableItem;
        var text = $scope.canvas.item(index).getText();
        if ($scope.canvas.item(index).get("type") == "curvedText") {
            $scope.canvas.item(index).set({
                radius: (100 - val) * 2.5
            });
            $scope.drawCanvas();
            return
        }
        var curve = $scope.canvas.item(index);
        var option = {};
        if($scope.rtlLang){
            option.rtl = true;
        }        
        option.left = curve.left;
        option.top = curve.top;
        option.textAlign = curve.textAlign;
        option.fill = curve.fill;
        option.angle = curve.angle;
        option.textBackgroundColor = curve.textBackgroundColor;
        option.stroke = curve.stroke;
        option.fontSize = curve.fontSize;
        option.fontFamily = curve.fontFamily;
        option.lineHeight = curve.lineHeight;
        option.height = curve.height;
        option.width = curve.width;
        option.radius = (100 - val) * 2.5;
        var curvedtext = new fabric.CurvedText(text, option);
        $scope.canvas.remove($scope.canvas.getActiveObject());
        $scope.drawCanvas();
        $scope.canvas.add(curvedtext);
        var index = $scope.canvas.getObjects().length - 1;
        if(NBDESIGNCONFIG['lang_rtl'] == 'rtl'){
            $scope.setItemConfig($scope.canvas.item(index), 'rtl', true); 
        }        
        $scope.canvas.setActiveObject($scope.canvas.item(index));
        $scope.canvas.item($scope.editableItem).centerH();
        $scope.canvas.item($scope.editableItem).centerV();
        $scope.canvas.item($scope.editableItem).setCoords();
        $scope.drawCanvas()
    };
    $scope.setSpacing = function() {
            if ($scope.editableItem == null) return;
            $scope.canvas.item($scope.editableItem).set("spacing", $scope.editable.spacing);
            $scope.drawCanvas()
        };
    $scope.changeEffect = function(val) {
        if ($scope.editableItem == null) return;
        $scope.canvas.item($scope.editableItem).set("effect", val);
        $scope.drawCanvas()
    };
    $scope.reverseCurve = function() {
        if ($scope.editableItem == null) return;
        var reverse = angular.element(document.querySelector("input#curve_reverse")).is(":checked");
        $scope.canvas.item($scope.editableItem).set("reverse",
            reverse);
        $scope.drawCanvas()
    };
    $scope.changePattern = function(path) {
        var url = $scope.ajustUrl(path);
        changePattern(url);
        jQuery("#dg-pattern").modal("hide");
        $scope.drawCanvas()
    };
    $scope.ajustUrl = function(path) {
        return od_mainURL + path
    };
    $scope.loadPattern = function() {
        if ($scope.patterns.length > 0) return;
        PatternService.fn(function(data) {
            if (data.flag == "1") $scope.patterns = data.data.patterns;
            else console.log("Error! Try again!")
        })
    };
    $scope.changePatternRepeat = function(val) {
        $scope.canvas.item($scope.editableItem).fill.repeat =
            val;
        $scope.drawCanvas()
    };
    $scope.setFontSize = function() {
        if ($scope.editableItem == null) return;
        $scope.canvas.item($scope.editableItem).setFontSize($scope.fontSize);
        $scope.drawCanvas()
    };
    $scope.setGradient = function() {
        if ($scope.editableItem == null) return;
        var option = createGradient();
        var direction = "h";
        direction = angular.element(document.querySelector('input[name="gradient_direction"]:checked')).val();
        var width = $scope.canvas.item($scope.editableItem).getWidth();
        var height = $scope.canvas.item($scope.editableItem).getHeight();
        if (direction == "h") $scope.canvas.item($scope.editableItem).setGradient("fill", {
            type: "linear",
            x1: -width,
            y1: 0,
            x2: 0,
            y2: 0,
            colorStops: option
        });
        else $scope.canvas.item($scope.editableItem).setGradient("fill", {
            type: "linear",
            x1: 0,
            y1: 0,
            x2: 0,
            y2: height / 2,
            colorStops: option
        });
        $scope.drawCanvas()
    };
    $scope.zoomOut = function() {
        $scope.zoom = $scope.zoom - .1;
        if ($scope.zoom <= 1) $scope.zoom = 1;
        $scope.canvas.setZoom($scope.zoom);
        $scope.drawCanvas();
        $scope.zoomCanvas()
    };
    $scope.zoomIn = function() {
        $scope.zoom = $scope.zoom + .1;
        if ($scope.zoom >=
            2) $scope.zoom = 2;
        $scope.zoomCanvas()
    };
    $scope.scaleItem = function(command) {
        var obj = $scope.canvas.getActiveObject();
        if (!obj) return;
        var scaleX = obj.scaleX,
            scaleY = obj.scaleY,
            left = obj.left,
            top = obj.top,
            width = obj.width * scaleX,
            height = obj.height * scaleY,
            factor = 1;
        if (command == "+") factor = 1.1;
        else factor = .9;
        var tempScaleX = scaleX * factor,
            tempScaleY = scaleY * factor,
            tempWidth = width * factor,
            tempHeight = height * factor,
            tempLeft = left + width / 2 - tempWidth / 2,
            tempTop = top + height / 2 - tempHeight / 2;
        obj.scaleX = tempScaleX;
        obj.scaleY = tempScaleY;
        obj.left = tempLeft;
        obj.top = tempTop;
        obj.setCoords();
        $scope.drawCanvas()
    };
    $scope.zoomCanvas = function() {
        var width = $scope.zoom * $scope.currentVariant.designArea["area_design_width"] * $scope.designScale;
        var height = $scope.zoom * $scope.currentVariant.designArea["area_design_height"] * $scope.designScale;
        $scope.canvas.setDimensions({
            "width": width,
            "height": height
        });
        $scope.canvas.calcOffset();
        $scope.canvas.setZoom($scope.zoom);
        $scope.drawCanvas()
    };
    $scope.loadProduct = function(id, variation, template) {
        ProductService.getProduct(id, variation, template).then(function(data) {
            $scope.onLoadProduct = false;
            window.parent.NBDESIGNERPRODUCT.nbdesigner_ready();
            $scope.varaints.areaDesign = data.product;
            $scope.rateConvertCm2Px = Math.round($scope.rateConvertCm2Px * (parseInt(data.dpi) / 96) * 10) / 10;
            $scope.ajustmentScale = $scope.designScale;
            if (toType(data.design) == "object"){
                $scope.canvases = data.design;                
                if(toType(data.ref) === "array"){
                    $scope.refProduct = data.ref;
                };
                if(toType(data.config) === "object"){
                    $scope.ajustmentScale = data.config['scale'];
                }                     
                if(toType(data.fonts) === "array"){
                    var font_url = NBDESIGNCONFIG['font_url'];
                    $scope.loadAdminDesignFont(data.fonts, font_url);
                    return;
                }             
                $scope.changeOrientation();    
                $scope.loaded = 100;
                hide_indicator()                
            } else {
                var sid = "p_" + product_id,
                cid = "c_" + product_id;
                if ((toType(localStorageService.get(sid)) === "object") && (OD_task == "") && !$scope.ignoreLocalDesign && !NBDESIGNCONFIG['is_designer']){
                    $scope.canvases = localStorageService.get(sid);
                    if(toType(localStorageService.get(cid)) === "object"){
                        var config = localStorageService.get(cid);
                        $scope.ajustmentScale = config['scale'];
                        $scope.loadAdminDesignFont(config['font_used'], config['furl']);
                    }    
                }else if(toType(data.admindesign) === "object"){
                    $scope.canvases = data.admindesign;    
                    if(toType(data.config) === "object"){
                        $scope.ajustmentScale = data.config['scale'];
                    }                      
                    if(toType(data.fonts) === "array"){
                        var font_url = NBDESIGNCONFIG['font_url'];
                        $scope.loadAdminDesignFont(data.fonts, font_url);
                    }   
                }else{
                    $scope.changeOrientation();            
                    $scope.loaded = 100;
                    hide_indicator()                      
                }
            }
        })
    };
    $scope.loadAdminListDesign = function(){
        if(! _.size($scope.adminListTemplate)){
            show_indicator();
            AdminTemplateService.getDesign(product_id).then(function(data) {                
                if(data['mes'] == 'success'){
                    _.each(data.data, function(value, index){
                        $scope.adminListTemplate.push({'src' : value[0], 'id' : index});
                    })
                }else{
                    alert('Oops! Try again');
                }
                hide_indicator();
            })
        }
        $('#nbdesigner-list-template').addClass('open');
        $('#design-editor-container').removeClass('open');
    };
    $scope.loadExtraAdminDesign = function(id){
        $scope.loaded = 0;
        $scope.ignoreLocalDesign = true;
        show_indicator();
        $('#dg-expand-feature').modal("hide");
        $scope.canvas.clear();
        $scope.loadProduct(product_id, 0, id);
    };
    $scope.loadAdminDesignFont = function(fonts, _url){
        _.each(fonts, function(font){
            if(font.type == "google"){
                var name = font.name;
                name = name.replace(" ", "+");
                jQuery("head").append("<link href='https://fonts.googleapis.com/css?family=" + name + "' rel='stylesheet' type='text/css'>")
            }else{
                if (!isFontAvailable(font.name)) {
                    var type = font.type,
                    url = _url + font.name + '.' + font.ext;
                    if (type = "ttf") type = "truetype";
                    var css = "";
                    css = "<style type='text/css'>";
                    css += "@font-face {font-family: '" + font.name + "';";
                    css += "src: local('\u263a'),";
                    css += "url('" + url + "') format('" + type + "')";
                    css += "}";
                    css += "</style>";
                    jQuery("head").append(css)
                }                
            }
        });
        var check = [], timeout = 0;
        var stop = $interval(function() {
            var _check = true;
            timeout += 100;
            _.each(fonts, function(font, key){
                if (!isFontAvailable(font.name)) {
                    check[key] = false;
                }else{
                    check[key] = true;
                }
            });
            _.each(check, function(c){
                if(!c) _check = false;
            });
            if(_check || timeout > 3000){
                $scope.changeOrientation();            
                $scope.loaded = 100;
                hide_indicator()                
                $interval.cancel(stop);                    
            }            
        }, 100);
    };
    $scope.loadLanguage = function(code) {
        var first = false;
        if(code == null){
            code = 'en';
            if(NBDESIGNCONFIG['lang_code'] != '') code = NBDESIGNCONFIG['lang_code'];
            first = true;
        } else{
            show_indicator();
            $(".translate-switch").removeClass('open');
        }
        LanguageService.getLang(code).then(function(data) {
            if(data.mes == "success"){
                $scope.langs = data.langs;
                _.each($scope.langs, function(val, key) {
                    $scope.langs[key] = val.replace(/\\/g, '');
                });                
                $scope.langCategories = data.cat;
                $scope.currentCatLang = data.code;
                _.each(langjs, function(value, key) {
                    langjs[key] = $scope.langs[key] ? $scope.langs[key] : langjs[key];
                });
                initTooltip();
            }
            if(first){
                $scope.loaded = 70;
            } else{
                hide_indicator();
            }
        })     
    };    
    $scope.loadFont = function(index) {
        if ($scope.fontCat.length > 0 || $scope.fonts.length > 0) return;
        FontService.fn(function(data) {
            if (data.flag == "1") {
                if (toType(data.cat) == "array") $scope.fontCat = data.cat;
                if (toType(data.fonts) == "array") {
                    $scope.fonts = data.fonts;
                    $scope.getAmountFont($scope.fonts, $scope.curentCatFont);
                    $scope.customFont = JSON.parse(JSON.stringify(data.fonts))
                }
                if (toType(data.google_font) == "array") {
                    $scope.google_font = data.google_font;
                    $scope.googleFont = JSON.parse(JSON.stringify(data.google_font))
                }
                $scope.AllFonts = $scope.fonts;
                $scope.changeFontPageSize(true)
            } else console.log("Error! Try again!")
        })
    };
    $scope.loadGoogleFont = function() {
        $scope.changeFontCat({
            "id": "99",
            "name": "Google Font"
        });
        $scope.changeFontPageSize(true)
    };
    $scope.changeFontPageSize = function(first) {
        var previousIndex =0,
            arr = [],
            list = "";
        if (!first) {
            previousIndex = $scope.fontPageSize;
            $scope.fontPageSize = $scope.fontPageSize + 10
        }
        if ($scope.curentCatFont == "99") {
            arr = $scope.googleFont;
            var lastIndex = previousIndex + 10;
            if (arr.length < lastIndex - 1) lastIndex = arr.length + 1;
            var _arr = arr.slice(previousIndex, lastIndex);
            _.each(_arr, function(val, key) {
                var name = val.name;
                name = name.split(" ").join("+");
                list = list + name + "|"
            });
            list = list.slice(0, list.length - 1);
            $("head").append("<link href='https://fonts.googleapis.com/css?family=" + list + "' rel='stylesheet' type='text/css'>")
        } else {
            arr = $scope.customFont;
            arr = $scope.filterCat(arr, $scope.curentCatFont);
            var lastIndex = previousIndex + 10;
            if (arr.length < lastIndex - 1) lastIndex = arr.length + 1;
            var _arr = arr.slice(previousIndex, lastIndex);
            _.each(_arr, function(val, key) {
                if (!isFontAvailable(val.alias)) {
                    var type = val.type;
                    if (type = "ttf") type = "truetype";
                    var css = "";
                    css = "<style type='text/css'>";
                    css += "@font-face {font-family: '" + val.alias + "';";
                    css += "src: local('\u263a'),";
                    css += "url('" + val.url + "') format('" + type + "')";
                    css += "}";
                    css += "</style>";
                    jQuery("head").append(css)
                }
            })
        }
        $("#nbdesigner_font_container").stop().animate({
            scrollTop: $("#nbdesigner_font_container").prop("scrollHeight")
        }, 400)            
    };
    $scope.filterCat = function(arr, id) {
        var output = [];
        _.each(arr, function(val, key) {
            if (val.cat.length == 0) val.cat = ["0"];
            if ($.inArray(id, val.cat) >= 0) output.push(val)
        });
        return output
    };
    $scope.changeFontCat = function(cat) {
        var first = false;
        if (cat.id == "99") $scope.AllFonts = $scope.google_font;
        else $scope.AllFonts = $scope.fonts;
        $scope.fontPageSizes[$scope.curentCatFont] = $scope.fontPageSize;
        if ($scope.fontPageSizes[cat.id]) $scope.fontPageSize = $scope.fontPageSizes[cat.id];
        else {
            first = true;
            $scope.fontPageSize = 10
        }
        $scope.currentCatFontName =
            cat.name;
        $scope.curentCatFont = cat.id;
        if (cat.id == "99") $scope.countFont = $scope.google_font.length;
        else {
            $scope.getAmountFont($scope.fonts, $scope.curentCatFont);
            if (first) $scope.changeFontPageSize(first)
        }
        $("#nbdesigner_font_container").stop().animate({
            scrollTop: 0
        }, 400)        
    };
    $scope.loadArt = function() {
        if ($scope.artCat.length > 0 || $scope.arts.length > 0) return;
        $scope.disableDrawMode();
        ArtService.fn(function(data) {
            if (data.flag == "1") {
                if (toType(data.cat) == "array") $scope.artCat = data.cat;                              
                if (toType(data.arts) == "array") {
                    $scope.arts = data.arts;
                    $scope.getAmountArt($scope.arts, $scope.curentCatArt)
                }
                _.each($scope.artCat, function(cat, key) {
                    cat.amount = $scope.countArtByCatID($scope.arts, cat.id);
                });                  
            } else console.log("Error! Try again!")
        })
    };
    $scope.changeArtCat = function(cat) {
        $scope.artPageSizes[$scope.curentCatArt] = $scope.artPageSize;
        if ($scope.artPageSizes[cat.id]) $scope.artPageSize = $scope.artPageSizes[cat.id];
        else $scope.artPageSize = 10;
        $scope.currentCatArtName = cat.name;
        $scope.curentCatArt = cat.id;
        $scope.getAmountArt($scope.arts, $scope.curentCatArt);
        $("#nbdesigner_art_container").stop().animate({
            scrollTop: 0
        }, 400)
    };
    $scope.loadMoreArt = function(){
        $scope.artPageSize += 10;
        $("#nbdesigner_art_container").stop().animate({
            scrollTop: $("#nbdesigner_art_container").prop("scrollHeight")
        }, 400)        
    };
    $scope.getAmountArt = function(input, cat_id) {
        $scope.countArt = 0;
        _.each(input, function(val, key) {
            if ($.inArray(cat_id, val.cat) >= 0) $scope.countArt++
        });
    };
    $scope.countArtByCatID = function(input, cat_id) {
        var count = 0;
        _.each(input, function(val, key) {
            if (val.cat.length == 0) val.cat = ["0"];
            if ($.inArray(cat_id, val.cat) >= 0) count++
        });
        return count;
    };    
    $scope.getAmountFont = function(input, cat_id) {
        $scope.countFont = 0;
        _.each(input, function(val, key) {
            if ($.inArray(cat_id, val.cat) >= 0) $scope.countFont++
        })
    };
    $scope.addArt = function(art) {
        fabric.loadSVGFromURL(art.url, function(ob, op) {
            $scope.canvas.add((new fabric.PathGroup(ob, op)).set({
                left: 100,
                top: 100
            }));
            $scope.canvas.setActiveObject($scope.canvas.item($scope.canvas.getObjects().length - 1));
            var max_width = $scope.canvas.width * .9;
            var max_height = $scope.canvas.height * .9;
            var new_width = max_width;
            if (op.width < max_width) new_width = op.width;
            var width_ratio = new_width / op.width;
            var new_height = op.height * width_ratio;
            if (new_height > max_height) {
                new_height = max_height;
                var height_ratio = new_height / op.height;
                new_width = op.width * height_ratio
            }
            var editable = $scope.canvas.getActiveObject();
            _.each(editable.paths, function(path, index) {});
            $scope.canvas.getActiveObject().set({
                scaleX: new_width / op.width,
                scaleY: new_height / op.height
            });
            $scope.ajustAfterAddItem("path-group");
            jQuery("#dg-cliparts").modal("hide");
            $scope.drawCanvas()
        })
    };
    $scope.showPathConfig = function() {
        if ($scope.editableItem == null) {
            $scope.editable._paths = [];
            $scope.editable.paths = [];
            return
        }
        var object = $scope.canvas.item($scope.editableItem);
        var type = object.get("type");
        if (type != "path-group" && type != "path") return;
        $scope.editable._paths = object.paths;
        $scope.editable.paths = $scope.getColorPath(object.paths)
    };
    $scope.getColorPath = function(paths) {
        var output = [];
        _.each(paths, function(path, key) {
            if (toType(path.fill) == 'string') {
                output.push({
                    "fill": tinycolor(path.fill).toHex(),
                    "key": key
                });
                $scope.pathColor[key] = tinycolor(path.fill).toHex()                
            }
        });
        return output
    };
    $scope.getColorCode = function(color) {
        return "#" + color
    };
    $scope.updatePathColor = function(color) {
        var hex = $scope.pathColor[color.key];
        hex = tinycolor(hex).toHexString();
        if ($scope.editable.type == "path-group") $scope.editable._paths[color.key].fill = hex;
        $scope.drawCanvas()
    };
    $scope.showGrid = function() {};
    $scope.deleteLayer = function(e) {
        deleteObject(e.index)
    };
    $scope.activeLayer = function(e) {
        if ($scope.canvas.item(e.index).get("selectable") && $scope.canvas.item(e.index).get("visible")) {
            $scope.canvas.setActiveObject($scope.canvas.item(e.index));
            $scope.drawCanvas()
        } else return
    };
    $scope.parseObject = function(str) {
        var f = str.replace(/'/g, '"');
        var e = JSON.parse(f);
        return e
    };
    $scope.changeVariant = function() {};
    $scope.changeOrientation = function(p) {
        var first = false;
        if (p == null) {
            p = {
                "name": "frame_0",
                "id": 0
            };
            first = true
        }
        $scope.currentVariant.orientationBefore = $scope.currentVariant.orientationActive;
        if (!first) $scope.saveDesign($scope.currentVariant.orientationBefore);
        $scope.currentVariant.orientationActive = p.name;
        var i = 0;
        $scope.currentVariant.info = [];
        _.each($scope.varaints.areaDesign, function(value, key) {
            if(!value['show_overlay']) value['show_overlay'] = "0";
            if(!value['img_overlay']) value['img_overlay'] = "";
            $scope.currentVariant.info[key] = {
                "source": value,
                "name": "frame_" + key,
                "v_index": $scope.currentVariant.index,
                "id": key
            };
            i++
        });
        var _img = [{
            "img_src": $scope.currentVariant.info[p.id]["source"]["img_src"],
            "bg_type": (!!$scope.currentVariant.info[p.id]["source"]["bg_type"]) ? $scope.currentVariant.info[p.id]["source"]["bg_type"] : 'image',
            "bg_color_value": (!!$scope.currentVariant.info[p.id]["source"]["bg_color_value"]) ? $scope.currentVariant.info[p.id]["source"]["bg_color_value"] : '#ffffff',
            "img_src_left": $scope.currentVariant.info[p.id]["source"]["img_src_left"],
            "img_src_top": $scope.currentVariant.info[p.id]["source"]["img_src_top"],
            "img_src_width": $scope.currentVariant.info[p.id]["source"]["img_src_width"],
            "img_src_height": $scope.currentVariant.info[p.id]["source"]["img_src_height"]
        }];
        $scope.currentVariant.numberFrame = i;
        $scope.currentVariant.activeImages = _img;
        $scope.currentVariant.designArea = $scope.varaints.areaDesign[p.id];
        var _width = $scope.currentVariant.designArea.area_design_width * $scope.designScale,
            _height = $scope.currentVariant.designArea.area_design_height * $scope.designScale;
        $scope.scale[p.name] = $scope.currentVariant.info[p.id]["source"]["real_width"] * $scope.rateConvertCm2Px / _width;
        $scope.currentScale = $scope.scale[p.name];
        $scope.canvas.setDimensions({
            "width": _width,
            "height": _height
        });
        if (!first) $scope.updateCurrentLayer();     
        $scope.canvas.clear();
        if($scope.currentVariant.info[p.id]["source"]["show_overlay"] == "1" && $scope.currentVariant.info[p.id]["source"]["img_overlay"] != ''){            
            var overlay_src = $scope.currentVariant.info[p.id]["source"]["img_overlay"],
                width = 500, height = 500;
            fabric.Image.fromURL(overlay_src, function(op) {
                width = op.width;
                height = op.height;
            });
            $scope.canvas.setOverlayImage(overlay_src, function(){                
                $scope.canvas.overlayImageLeft = 0;
                $scope.canvas.overlayImageTop = 0;
                $scope.canvas.overlayImage.scaleX = $scope.canvas.width / width;
                $scope.canvas.overlayImage.scaleY = $scope.canvas.height / height;
                $scope.canvas.renderAll()
            });
        } else {
            $scope.canvas.overlayImage = null;           
        }    
        if (angular.isDefined($scope.canvases[p.name])){
            $scope.canvas.loadFromJSON($scope.canvases[p.name], function() {            
                applyImageFilters();
                $scope.canvas.renderAll();
                $scope.updateCurrentLayerAfterDelete();
                if(angular.isUndefined($scope.flagChangeOrientation[p.id])){
                    $scope.resizeDesign($scope.designScale, $scope.ajustmentScale);
                    $scope.fitReferenceDesign(p.id);
                    $scope.flagChangeOrientation[p.id] = 1;
                }else if($scope.ignoreLocalDesign){
                    $scope.resizeDesign($scope.designScale, $scope.ajustmentScale);               
                } else if($scope.ajustmentOrientationScale[p.id] != $scope.designScale){
                    $scope.resizeDesign($scope.designScale, $scope.ajustmentOrientationScale[p.id]);
                }   
                $scope.ajustmentOrientationScale[p.id] = $scope.designScale;
            });
        }
        if(angular.isDefined($scope.fontCollection[p.name])){
            $scope.currentFontCollection = JSON.parse($scope.fontCollection[p.name]);
        }    
        $scope.updateUndoRedoStatus();
        $scope.showAlignToolbar = false;
        $scope.zoom = 1;
        $scope.zoomCanvas();    
        $scope.drawCanvas();   
        $scope.canvas.isDrawingMode = false
    };  
    $scope.resizeDesign = function(newScale, oldScale){
        if(newScale == oldScale) return;
        var factor = newScale / oldScale;
        $scope.canvas.forEachObject(function(obj) {     
            var scaleX = obj.scaleX,
            scaleY = obj.scaleY,
            left = obj.left,
            top = obj.top,
            tempScaleX = scaleX * factor,
            tempScaleY = scaleY * factor,
            tempLeft = left * factor,
            tempTop = top * factor;   
            obj.scaleX = tempScaleX;
            obj.scaleY = tempScaleY;
            obj.left = tempLeft;
            obj.top = tempTop;  
            obj.setCoords();
        });   
        $scope.canvas.calcOffset();
        $scope.drawCanvas();        
    };
    $scope.snapGrid = function(){
        $scope.gridMode = ! $scope.gridMode;
        jQuery('.canvas-container .upper-canvas').toggleClass('has-grid');
    };
    $scope.fitReferenceDesign = function(id){
        if(OD_ref == '') return;
        var ref_width = $scope.refProduct[id]["area_design_width"],
        ref_height = $scope.refProduct[id]["area_design_height"],
        width = $scope.currentVariant.info[id]["source"]["area_design_width"],
        height = $scope.currentVariant.info[id]["source"]["area_design_height"];
        if((ref_width/ref_height) > (width/height)){
            $scope.resizeDesign(width/ref_width, 1);
            var offset_top = (height - ref_height*width/ref_width) * $scope.zoom * $scope.designScale / 2;
            $scope.canvas.forEachObject(function(obj) {  
                obj.top = obj.top + offset_top;   
            })
        }else{
            $scope.resizeDesign(height/ref_height, 1);
            var offset_left = (width - ref_width*height/ref_height) * $scope.zoom * $scope.designScale / 2;
            $scope.canvas.forEachObject(function(obj) {  
                obj.left = obj.left + offset_left;    
            })            
        }    
        $scope.canvas.calcOffset();
        $scope.drawCanvas();          
    };
    $scope.saveDesign = function(orientation) {
        if (orientation == null) orientation = $scope.currentVariant.orientationActive;
        $scope.zoom = 1;
        $scope.zoomCanvas();
        $scope.drawCanvas();
        var json = canvas.toJSON(['itemId', 'selectable', 'lockMovementX', 'lockMovementY', 'lockScalingX', 'lockScalingY', 'lockRotation', 'rtl', 'elementUpload', 'forceLock']);      
        if ($scope.modeMobile) {
            var _width = $scope.currentVariant.designArea.area_design_width * $scope.designScale,
                _height = $scope.currentVariant.designArea.area_design_height * $scope.designScale;
            if (_width > _height)
                if (_width * $scope.currentScale > 1E3) $scope.zoom = 1E3 / _width;
                else $scope.zoom = $scope.currentScale;
            else if (_height * $scope.currentScale > 1E3) $scope.zoom = 1E3 / _height;
            else $scope.zoom = $scope.currentScale
        } else $scope.zoom = $scope.currentScale;
        $scope.zoomCanvas();
        $scope.drawCanvas();
        var svg = canvas.deactivateAll().toDataURL();
        $scope.canvases[orientation] = json;
        $scope.fontCollection[orientation] = JSON.stringify($scope.currentFontCollection);
        $scope.dataCustomerDesign[orientation] = svg;
        $scope.currentPreview = svg;
        $scope.zoom = 1;
        $scope.zoomCanvas();
        $scope.drawCanvas();
        var sid = "p_" + product_id,
        cid = "c_" + product_id;
        config = {};
        config['scale'] = $scope.designScale;        
        config['furl'] = NBDESIGNCONFIG['font_url'];      
        config['font_used'] = $scope.filterFontUsed();      
        try {
            localStorageService.set(sid, $scope.canvases);
            localStorageService.set(cid, config);
        } catch (e) {
            localStorageService.clearAll();
            localStorageService.set(sid, $scope.canvases);
            localStorageService.set(cid, config);
        }
    };
    $scope.usedFont = function(cv) {
        var font = [];
        cv.forEachObject(function(object) {
            if (object.type === "i-text" || object.type === "text" || object.type === "curvedText") font.push(object.get('fontName'));
        });
        return font
    };
    $scope.filterFontUsed = function(){
        var usedFonts = [];
        _.forEach($scope.fontCollection, function(value) {
            var fonts = JSON.parse(value);
            _.each(fonts, function(v) {
                if(toType(v) == 'object'){
                    if(v.cat[0] == "99"){
                        usedFonts.push({'type': 'google', 'name' : v.name});
                    }else{
                        usedFonts.push({'type': 'custom', 'name' : v.alias, 'ext' : v.type});
                    }
                }
            });            
        });
        return usedFonts;
    };
    $scope.preview = function() {
        $scope.saveDesign()
    };
    $scope.storeDesign = function() {
        $scope.saveDesign();
        var fonts = $scope.filterFontUsed(),
        config = {};
        config['scale'] = $scope.designScale;
        if(!$scope.partialSave){
            NBDESIGNERCART.upload_design($scope.dataCustomerDesign, $scope.canvases, fonts, config);
            //NBDESIGNERCART.upload_blod($scope.dataCustomerDesign, $scope.canvases, fonts, config);
        }else{
            NBDESIGNERCART.initData($scope.dataCustomerDesign, $scope.canvases, 0);
            NBDESIGNERCART.partial_upload($scope.dataCustomerDesign, $scope.canvases, fonts, config);            
        }
    };
    $scope.storeDesign1 = function() {
        show_indicator();
        localStorageService.set("design", $scope.canvases);
        $scope.currentUser = "";
        var fonts = {},
            images = {};
        $scope.saveDesign();
        $scope.zoom = 5;
        $scope.zoomCanvas();
        var orientationActive = $scope.currentVariant.orientationActive;
        _.each($scope.canvases, function(value, key) {
            var key = "frame_1";
            var p = {
                "name": key
            };
            $scope.changeOrientation(p);
            fonts[key] = $scope.usedFont($scope.canvas);
            if (/MSIE/.test(navigator.userAgent)) images[key] = $scope.canvas.deactivateAll().toSVG();
            else images[key] = $scope.canvas.deactivateAll().toSVG()
        });
        $scope.changeOrientation({
            "name": orientationActive
        });
        console.log($scope.canvas.deactivateAll().toSVG());
        UserService.getUserId().then(function(data) {
            $scope.currentUser = data;
            if ($scope.currentUser !== "" || $scope.currentUser > 0)
                if (/MSIE/.test(navigator.userAgent)) var query = "type=saveDesignIE";
                else var query =
                    "type=saveDesign";
            if ($scope.currentUser != 0 && $scope.currentUser != "") StoreService.postData(fonts, images, query);
            $scope.zoom = 1;
            $scope.zoomCanvas();
            hide_indicator()
        })
    };
    $scope.toggleImportArea = function(){
        $('#design-editor-container').toggleClass('open');
        $('#nbdesigner-list-template').removeClass('open');
        $("#nbdesigner-list-template").stop().animate({
            scrollTop: 0
        }, 400)         
    };
    $scope.exportDesign = function(){
        $scope.saveDesign();
        var filename = 'design.json',
        text = JSON.stringify($scope.canvases),
        a = document.createElement('a');
        a.setAttribute('href', 'data:text/plain;charset=utf-u,'+ text);
        a.setAttribute('download', filename);
        a.click()       
    };
    $scope.downloadPNG = function(){
        $scope.saveDesign();
        _.each($scope.dataCustomerDesign, function(val, key){
            var filename = key + '.png',
            a = document.createElement('a');
            a.setAttribute('href', val);
            a.setAttribute('download', filename);
            a.click() 
        });       
    };
    $scope.downloadJPG = function(){
        $scope.saveDesign();
        _.each($scope.dataCustomerDesign, function(val, key){
            var filename = key + '.jpg',
            a = document.createElement('a');
            a.setAttribute('href', val);
            a.setAttribute('download', filename);
            a.click() 
        });       
    };    
    $scope.importDesign = function(){
        var datadesign = JSON.parse($('#design-json-content').val());
        if(toType(datadesign) === 'object'){            
            show_indicator();
            $scope.canvases = datadesign;
            $scope.changeOrientation();  
            hide_indicator();   
        }
        $('#dg-expand-feature').modal("hide");
    };
    $scope.resetAdminDesign = function(){
        $scope.loaded = 0;
        $scope.ignoreLocalDesign = true;
        show_indicator();
        $('#dg-expand-feature').modal("hide");
        $scope.canvas.clear();
        $scope.loadProduct(product_id, 0, 'primary');
        $scope.clearHistory();
    };
    $scope.calcLeft = function(left) {
        if (angular.isDefined(left)) {
            var offsetWidth = $scope.designerWidth / 2;
            left *= $scope.designScale;
            return offsetWidth - (offsetWidth - left) * $scope.zoom
        }
    };
    $scope.calcWidthThumb = function(n){
        if(n < 4) return n; else return 4;
    };
    $scope.calcDimension = function(width) {
        width = $scope.zoom * width * $scope.designScale;
        width = width + "px";
        return width
    };
    $scope.addLayers = function(object, type, index) {
        var layer = {};
        if (type === "text" || type === "i-text" || type === "curvedText") {
            var title = object.text;
            if (title.length > 20) title = title.substring(0, 19);
            if(object.rtl) title = reverseString(title);
            layer = {
                "name": title,
                "type": "text",
                "src": "",
                "index": index
            }
        }
        if (type === "image") layer = {
            "name": langjs["LAYER_IMAGE"],
            "type": "image",
            "src": object.getSvgSrc(),
            "index": index
        };
        if (type == "custom-image") layer = {
            "name": langjs["LAYER_IMAGE"],
            "type": "image",
            "src": object.origin_src,
            "index": index
        };
        if (type === "path-group") layer = {
            "name": "SVG",
            "type": "path-group",
            "src": od_mainURL + "images/svg.png",
            "index": index
        };
        if (type ===
            "group") layer = {
            "name": langjs["LAYER_GROUP"],
            "type": "path-group",
            "src": od_mainURL + "images/svg.png",
            "index": index
        };
        if (type === "path") layer = {
            "name": langjs["LAYER_PATH"],
            "type": "path",
            "src": od_mainURL + "images/path.png",
            "index": index
        };
        if (type === "rect") layer = {
            "name": langjs["LAYER_RECTANGLE"],
            "type": "rect",
            "src": od_mainURL + "images/mark/mark_12.svg",
            "index": index
        };
        if (type === "circle") layer = {
            "name": langjs["LAYER_CIRCLE"],
            "type": "circle",
            "src": od_mainURL + "images/mark/mark_03.svg",
            "index": index
        };
        if (type === "triangle") layer = {
            "name": langjs["LAYER_TRIANGLE"],
            "type": "triangle",
            "src": od_mainURL +
                "images/mark/mark_13.svg",
            "index": index
        };
        if (type === "line") layer = {
            "name": langjs["LAYER_LINE"],
            "type": "line",
            "src": od_mainURL + "images/path.png",
            "index": index
        };
        if (type === "polygon") layer = {
            "name": langjs["LAYER_POLYGON"],
            "type": "polygon",
            "src": od_mainURL + "images/mark/mark_11.svg",
            "index": index
        };
        if(!object.get("selectable") || !object.get("visible")){
            layer.class = "lock";
        }else{
            layer.class = '';
        }
        if (angular.isUndefined($scope.layers[$scope.currentVariant.orientationActive])) $scope.layers[$scope.currentVariant.orientationActive] = [];
        var layers = $scope.layers[$scope.currentVariant.orientationActive];
        layers[index] = layer;
        $scope.updateCurrentLayer()
    };
    $scope.sortLayer = function(from, to) {
        var length = $scope.canvas.getObjects().length;
        if (angular.isUndefined(from) || angular.isUndefined(to)) return;
        if (from < to) {
            for (var j = 0; j < from; j++) $scope.bringToFront(0);
            for (j = 0; j < to - from; j++) $scope.bringToFront(1);
            for (j = to; j < length; j++) $scope.bringToFront(0)
        } else {
            for (var j = 0; j < to; j++) $scope.bringToFront(0);
            $scope.bringToFront(from - to);
            for (j = 0; j < length - to - 1; j++) $scope.bringToFront(0)
        }
        $scope.updateCurrentLayerAfterDelete();
        $scope.canvas.deactivateAll();
        $scope.canvas.setActiveObject($scope.canvas.item(to))
    };
    $scope.bringToFront = function(index) {
        $scope.canvas.item(index).bringToFront()
    };
    $scope.setStackPosition = function(command) {
        var object = canvas.getActiveObject();
        if (object == null) return;
        switch (command) {
            case "bringToFront":
                object.bringToFront();
                break;
            case "bringForward":
                object.bringForward();
                break;
            case "sendBackwards":
                object.sendBackwards();
                break;
            case "sendToBack":
                object.sendToBack();
                break
        }
        $scope.canvas.setActiveObject(object);
        $scope.updateCurrentLayerAfterDelete()
    };
    $scope.updateCurrentLayerAfterDelete = function() {
        var index = $scope.canvas.getObjects().length;
        $scope.layers[$scope.currentVariant.orientationActive] = [];
        if (index === 0) {
            $scope.layers[$scope.currentVariant.orientationActive] = [];
            $scope.currentLayers = [];
            return
        }
        for (var i = 0; i < index; i++) {
            var type = $scope.canvas.item(i).get("type");
            $scope.addLayers($scope.canvas.item(i), type, i)
        }
    };
    $scope.updateCurrentLayer = function() {
        $scope.currentLayers = $scope.layers[$scope.currentVariant.orientationActive]
    };
    $scope.getQrCode = function() {
        QrcodeService.fn($scope.qrCodeContent, function(data) {
            if (data.flag == "1") {
                var html = '<img src="' + data.src + '" class="qr_image shadow hover-shadow" onclick="NBDESIGNERFUNC.addQrImage(\'' + data.src + "')\" spinner-on-load />";
                $("#qrcode-img").html("");
                $("#qrcode-img").append(html);
                $scope.uploadURL.push(data.src);
                localStorageService.set($scope.iid, $scope.uploadURL)
            } else alert("Error! Try again!")
        })
    };
    $scope.showDrawConfig = function() {
        showConfig();
        $scope.showPopover("draw")
    };
    $scope.changeDrawMode = function() {
        $scope.canvas.isDrawingMode = true;
        $scope.freeDrawingMode = "Pencil";
        $scope.setDrawingLineColor($scope.colorBrush);
        $scope.setDrawingLineWidth($scope.brushWidth);
        $scope.setDrawingLineShadowWidth($scope.brushShadowWidth);
        $scope.setDrawingLineOpacity($scope.brushOpacity)
    };
    $scope.disableDrawMode = function() {
        $scope.canvas.isDrawingMode = false
    };
    $scope.setDrawingMode = function(type) {
        $scope.canvas.isDrawingMode = true;
        $scope.freeDrawingMode = type;
        if (type === "hline") $scope.canvas.freeDrawingBrush = $scope.vLinePatternBrush;
        else if (type === "vline") $scope.canvas.freeDrawingBrush = $scope.hLinePatternBrush;
        else if (type === "square") $scope.canvas.freeDrawingBrush =
            $scope.squarePatternBrush;
        else if (type === "diamond") $scope.canvas.freeDrawingBrush = $scope.diamondPatternBrush;
        else if (type === "texture") $scope.canvas.freeDrawingBrush = $scope.texturePatternBrush;
        else $scope.canvas.freeDrawingBrush = new fabric[type + "Brush"]($scope.canvas);
        jQuery("#brush_width").slider("value", 0);
        jQuery("#brush_shadow_width").slider("value", 0);
        if (!jQuery("#show_popover_option_draw").hasClass("open")) jQuery("#show_popover_option_draw").triggerHandler("click")
    };
    $scope.setDrawingLineColor = function(value) {        
        value = tinycolor(value).toHexString();
        if ($scope.canvas.freeDrawingBrush) $scope.canvas.freeDrawingBrush.color = value
    };
    $scope.setDrawingLineWidth = function(value) {
        if ($scope.canvas.freeDrawingBrush) $scope.canvas.freeDrawingBrush.width = parseInt(value, 10) || 1
    };
    $scope.setDrawingLineOpacity = function(value) {
        if ($scope.canvas.freeDrawingBrush) $scope.canvas.freeDrawingBrush.opacity = value
    };
    $scope.setDrawingLineShadowWidth = function(value) {
        if ($scope.canvas.freeDrawingBrush) {
            var blur = parseInt(value, 10) || 1;
            if (blur > 0) $scope.canvas.freeDrawingBrush.shadow =
                new fabric.Shadow({
                    blur: blur,
                    offsetX: 10,
                    offsetY: 10
                });
            else $scope.canvas.freeDrawingBrush.shadow = null
        }
    };
    $scope.initBrushes = function() {
        if (!fabric.PatternBrush) return;
        $scope.initVLinePatternBrush();
        $scope.initHLinePatternBrush();
        $scope.initSquarePatternBrush();
        $scope.initDiamondPatternBrush();
        $scope.initImagePatternBrush()
    };
    $scope.initImagePatternBrush = function() {
        var img = new Image;
        img.src = od_mainURL + "images/honey_im_subtle.png";
        $scope.texturePatternBrush = new fabric.PatternBrush(canvas);
        $scope.texturePatternBrush.source =
            img
    };
    $scope.initDiamondPatternBrush = function() {
        $scope.diamondPatternBrush = new fabric.PatternBrush(canvas);
        $scope.diamondPatternBrush.getPatternSrc = function() {
            var squareWidth = 10,
                squareDistance = 5;
            var patternCanvas = fabric.document.createElement("canvas");
            var rect = new fabric.Rect({
                width: squareWidth,
                height: squareWidth,
                angle: 45,
                fill: this.color
            });
            var canvasWidth = rect.getBoundingRectWidth();
            patternCanvas.width = patternCanvas.height = canvasWidth + squareDistance;
            rect.set({
                left: canvasWidth / 2,
                top: canvasWidth / 2
            });
            var ctx = patternCanvas.getContext("2d");
            rect.render(ctx);
            return patternCanvas
        }
    };
    $scope.initSquarePatternBrush = function() {
        $scope.squarePatternBrush = new fabric.PatternBrush(canvas);
        $scope.squarePatternBrush.getPatternSrc = function() {
            var squareWidth = 10,
                squareDistance = 2;
            var patternCanvas = fabric.document.createElement("canvas");
            patternCanvas.width = patternCanvas.height = squareWidth + squareDistance;
            var ctx = patternCanvas.getContext("2d");
            ctx.fillStyle = this.color;
            ctx.fillRect(0, 0, squareWidth, squareWidth);
            return patternCanvas
        }
    };
    $scope.initVLinePatternBrush = function() {
        $scope.vLinePatternBrush = new fabric.PatternBrush(canvas);
        $scope.vLinePatternBrush.getPatternSrc = function() {
            var patternCanvas = fabric.document.createElement("canvas");
            patternCanvas.width = patternCanvas.height = 10;
            var ctx = patternCanvas.getContext("2d");
            ctx.strokeStyle = this.color;
            ctx.lineWidth = 5;
            ctx.beginPath();
            ctx.moveTo(0, 5);
            ctx.lineTo(10, 5);
            ctx.closePath();
            ctx.stroke();
            return patternCanvas
        }
    };
    $scope.initHLinePatternBrush = function() {
        $scope.hLinePatternBrush = new fabric.PatternBrush(canvas);
        $scope.hLinePatternBrush.getPatternSrc = function() {
            var patternCanvas = fabric.document.createElement("canvas");
            patternCanvas.width = patternCanvas.height = 10;
            var ctx = patternCanvas.getContext("2d");
            ctx.strokeStyle = this.color;
            ctx.lineWidth = 5;
            ctx.beginPath();
            ctx.moveTo(5, 0);
            ctx.lineTo(5, 10);
            ctx.closePath();
            ctx.stroke();
            return patternCanvas
        }
    };
    $scope.getRandomColor = function() {
        return colorTrend[Math.floor(Math.random() * colorTrend.length)]
    };
    $scope.addRect = function() {
        $("#opacity_shape").slider("value", 0);
        var _default =
            $scope.designerWidth > 50 ? 50 : $scope.designerWidth;
        $scope.canvas.add(new fabric.Rect({
            left: 0,
            top: 0,
            fill: "#" + $scope.getRandomColor(),
            width: _default,
            height: _default,
            opacity: 1
        }));
        $scope.ajustAfterAddItem("rect")
    };
    $scope.addCircle = function() {
        $("#opacity_shape").slider("value", 0);
        var _default = $scope.designerWidth > 50 ? 50 : $scope.designerWidth;
        $scope.canvas.add(new fabric.Circle({
            left: 0,
            top: 0,
            fill: "#" + $scope.getRandomColor(),
            radius: _default,
            opacity: 1
        }));
        $scope.ajustAfterAddItem("circle")
    };
    $scope.addTriangle = function() {
            $("#opacity_shape").slider("value", 0);
            var _default = $scope.designerWidth > 50 ? 50 : $scope.designerWidth;
            $scope.canvas.add(new fabric.Triangle({
                left: 0,
                top: 0,
                fill: "#" + $scope.getRandomColor(),
                width: _default,
                height: _default,
                opacity: 1
            }));
            $scope.ajustAfterAddItem("triangle")
    };
    $scope.addLine = function() {
        $("#opacity_shape").slider("value", 0);
        $scope.canvas.add(new fabric.Line([50, 100, 200, 200], {
            left: 0,
            top: 0,
            stroke: "#" + $scope.getRandomColor()
        }));
        $scope.ajustAfterAddItem("line")
    };
    $scope.addPolygon = function(type) {
        $("#opacity_shape").slider("value",
            0);
        $scope.canvas.add(new fabric.Polygon([{
            x: 40,
            y: 60
        }, {
            x: 60,
            y: 74.641
        }, {
            x: 57.321,
            y: 50
        }, {
            x: 80,
            y: 40
        }, {
            x: 57.321,
            y: 30
        }, {
            x: 60,
            y: 5.359
        }, {
            x: 40,
            y: 20
        }, {
            x: 20,
            y: 5.359
        }, {
            x: 22.679,
            y: 30
        }, {
            x: 0,
            y: 40
        }, {
            x: 22.679,
            y: 50
        }, {
            x: 20,
            y: 74.641
        }], {
            left: 0,
            top: 0,
            fill: "#" + $scope.getRandomColor()
        }));
        $scope.ajustAfterAddItem("polygon")
    };
    $scope.setShapeColor = function(e) {
        e = tinycolor(e).toHexString();
        if ($scope.editable.type === "line") {
            $scope.changeStroke(e);
        } else if ($scope.editable.type === "rect" || $scope.editable.type === "triagle" || $scope.editable.type === "polygon" || $scope.editable.type === "circle"){
            $scope.changeColor(e)
        }
    };
    $scope.dosomething = function() {
        console.log("hello kitty")
    };
    $scope.onFileSelect = function($files) {
        $scope.errorUpload = "";
        $scope.progressUpload = 0;
        $scope.file = [];
        var max_size = parseInt($scope.settings.max_size_upload),     
        min_size = parseInt($scope.settings.min_size_upload);        
        for (var i = 0; i < $files.length; i++) {
            if ($files[i].type.indexOf("image") === -1) {
                $scope.errorUpload = langjs['MES_ALLOW_UPLOAD_IMG'];
                continue
            }
            if ($files[i].size > max_size * 1024 * 1024) {
                $scope.errorUpload = langjs['MES_ERROR_MAXSIZE_UPLOAD'] + " " + max_size + " MB";
                continue
            }else if($files[i].size < min_size * 1024 * 1024){
                $scope.errorUpload = langjs['MES_ERROR_MINSIZE_UPLOAD'] + " " + max_size + " MB";
                continue                
            }
            $scope.file.push($files[i]);
            var fileReader = new FileReader;
            fileReader.readAsDataURL($files[i]);
            var loadFile = function(fileReader, index) {
                fileReader.onload = function(e) {
                    $timeout(function() {
                        $scope.src = e.target.result
                    })
                }
            }(fileReader, i)
        }
    };
    $scope.startUpload = function() {
        if(jQuery('#accept_term').length > 0 && !jQuery('#accept_term').is(':checked')){
            alert(langjs['TERM_ALERT']);
            return;
        }
        if ($scope.errorUpload == "") {
            jQuery('#upload-tabs a[href="#uploaded-photo"]').tab("show");
            $scope.loading = true;
            for (var i = 0; i < $scope.file.length; i++) {
                $scope.progressUpload = 1;
                $scope.upload = $upload.upload({
                    url: window.parent.nbds_frontend.url,
                    method: "POST",
                    withCredentials: true,
                    data: {
                        "action": "nbdesigner_customer_upload",
                        "nonce": window.parent.nbds_frontend.nonce
                    },
                    file: $scope.file[i]
                }).progress(function(evt) {
                    $scope.progressUpload = parseInt(100 * evt.loaded / evt.total)
                }).success(function(data, status, headers, config) {
                    if (angular.isUndefined(data.src)) alert("The file exist or upload failed, try later !!");
                    else {
                        $scope.uploadURL.push(data.src);
                        localStorageService.set($scope.iid, $scope.uploadURL)
                    }
                    $scope.loading = false
                })
            }
            if ($scope.file.length == 0) $scope.loading = false
        } else alert($scope.errorUpload)
    };
    $scope.loadLocalStorageImage = function() {
        $scope.disableDrawMode();
        var localSource = localStorageService.get($scope.iid, $scope.uploadURL);
        if (!!localSource && toType(localSource) == "array") $scope.uploadURL = localSource;
        $scope.loaded = 30
    };
    $scope.hasGetUserMedia = function(){
        return !!(navigator.getUserMedia || navigator.webkitGetUserMedia ||
            navigator.mozGetUserMedia || navigator.msGetUserMedia);        
    };
    $scope.initWebcam = function(){
        $scope.statusWebcam = true;
        Webcam.set({
            width: 400,
            height: 300,
            dest_width: 1280,
            dest_height: 960,
            image_format: 'jpeg',
            jpeg_quality: 100
        });                            
        Webcam.attach( '#my_camera' );     
        Webcam.setSWFLocation(NBDESIGNCONFIG['url_style'] + 'webcam.swf');  
    };
    $scope.takeSnapshot = function(){
        show_indicator();
        Webcam.snap( function(data_uri) {
            $scope.resetWebcam();
            $scope.statusWebcam = false;
            var raw_image_data = data_uri.replace(/^data\:image\/\w+\;base64\,/, '');
            jQuery.ajax({
                url: window.parent.nbds_frontend.url,
                method: "POST",   
                data: {
                    "action": "nbdesigner_save_webcam_image",
                    "image": raw_image_data,
                    "nonce": window.parent.nbds_frontend.nonce                  
                }
            }).done(function(data){
                hide_indicator();
                data = JSON.parse(data);
                if(data.flag == 'success'){
                    jQuery("#dg-myclipart").modal("hide");
                    $scope.addImage(data.url);
                }else{
                    alert('Oops! Try again!');
                    $scope.initWebcam();
                }
            });
        } );       
    };
    $scope.pauseWebcam = function(){
        Webcam.freeze();
    };
    $scope.unPauseWebcam = function(){
        Webcam.unfreeze();
    };    
    $scope.resetWebcam = function(){
        if($scope.statusWebcam){
            Webcam.reset();
            $scope.statusWebcam = false;
            $scope.langs['STOPWEBCAM'] = $scope.langs["STARTWEBCAM"] ? $scope.langs["STARTWEBCAM"] : 'Start Webcam';
        }else{
            $scope.initWebcam();
            $scope.statusWebcam = true;
            $scope.langs['STOPWEBCAM'] = $scope.langs["STOPWEBCAM2"] ? $scope.langs["STOPWEBCAM2"] : 'Stop Webcam';
        }        
    };      
    $scope.loadMoreFacebookPhoto = function() {
        if ($("#nbdesigner_fb_next").val() == "") return;
        nbdesigner_fb1()
    };
    $scope.addImage = function(url, params) {
        $scope.zoom = 1;
        $scope.zoomCanvas();
        fabric.Image.fromURL(url, function(op) {
            jQuery("#dg-myclipart").modal("hide");
            jQuery("#dg-qrcode").modal("hide");
            if(params){
                var element = $scope.canvas.getActiveObject().getElement();
                $scope.setUndoRedo({
                    element: $scope.canvas.getActiveObject(),
                    parameters: JSON.stringify({"src" : element.src}),
                    interaction: "modify"
                });  
                element.setAttribute("src", url);    
                $scope.updateCurrentLayerAfterDelete();
            } else {
                $scope.canvas.add(op);
                $scope.showPopover("art");
                $scope.canvas.setActiveObject($scope.canvas.item($scope.canvas.getObjects().length - 1));
                var max_width = $scope.canvas.width * .9;
                var max_height = $scope.canvas.height * .9;
                var new_width = max_width;
                if (op.width < max_width) new_width = op.width;
                var width_ratio = new_width / op.width;
                var new_height = op.height * width_ratio;
                if (new_height > max_height) {
                    new_height = max_height;
                    var height_ratio = new_height / op.height;
                    new_width = op.width * height_ratio
                }
                $scope.canvas.getActiveObject().set({
                    scaleX: new_width / op.width,
                    scaleY: new_height / op.height
                });
                $scope.ajustAfterAddItem("image");                
            }
            $scope.drawCanvas()
        }, {crossOrigin: 'anonymous'})
    };
    $scope.addImageFromUrl = function() {
        if ($scope.imageFromUrl == "") {
            alert("Image url empty!");
            return
        }
        show_indicator();
        fabric.util.loadImage($scope.imageFromUrl, function(img) {
            if (img == null) alert("Error!");
            else {
                jQuery.ajax({
                    url: window.parent.nbds_frontend.url,
                    method: "POST",
                    data: {
                        "action": "nbdesigner_copy_image_from_url",
                        "nonce": window.parent.nbds_frontend.nonce,
                        "url": $scope.imageFromUrl
                    }
                }).done(function(data) {
                    data = JSON.parse(data);
                    if(data['flag'] == 1){
                        hide_indicator();
                        $scope.addImage(data['src'])
                    } else{
                        hide_indicator();
                        jQuery('#upload-tabs a[href="#upload-computer"]').tab("show");
                        alert('Try to download image and then upload to our server!');
                    }
                    
                })
            }
        })
    };
    $scope.resetImage = function() {
        var object = $scope.canvas.getActiveObject();
        if (object == null) return;
        object.filters = [];
        object.applyFilters();
        var _url = "";
        if ($scope.canvas.item($scope.editableItem).get("type") == "custom-image") {
            _url = $scope.canvas.item($scope.editableItem).origin_src;
            if (_url != "") {
                $scope.canvas.remove($scope.canvas.getActiveObject());
                $scope.addImage(_url)
            }
        }
        $scope.drawCanvas()
    };
    $scope.loadSource = function() {
        var localSource = localStorageService.get($scope.iid, $scope.uploadURL);
        if (!!localSource && toType(localSource) == "array") $scope.uploadURL = localSource;
        $scope.loaded = 30
    };
    $scope.initCropCanvas = function(type) {
        canvas2.clear();
        canvas2.calcOffset();
        canvas2.setZoom(1);
        canvas2.renderAll();
        canvas2.isDrawingMode = false;
        if ($scope.editableItem == null) return;
        if (type === "crop") {
            $scope.cropToolMode = true;
            $scope.clipPathMode = false
        } else {
            $scope.cropToolMode = false;
            $scope.clipPathMode = true
        }
        var width = 400,
            height = 400;
        var _url = "";
        if ($scope.canvas.item($scope.editableItem).get("type") == "image") _url = $scope.canvas.item($scope.editableItem).getSvgSrc();
        if ($scope.canvas.item($scope.editableItem).get("type") == "custom-image") _url = $scope.canvas.item($scope.editableItem).origin_src;
        var url = _url,
            _type =
            $scope.canvas.item($scope.editableItem).type;
        if (url == "") return;
        if (!$scope.modeMobile) {
            width = 600;
            height = 400
        } else {
            width = $(window).width() - 20;
            height = 250
        }
        canvas2.setDimensions({
            "width": width,
            "height": height
        });
        $("#shape_canvas").css({
            "width": width,
            "height": height
        });
        var ratio = 1;
        var originImg = new Image;
        originImg.onload = function() {
            op = new fabric.Image(originImg);
            canvas2.add(op);
            var new_width = op.width;
            if (op.width > width) new_width = width;
            var width_ratio = op.width / new_width;
            var new_height = op.height / width_ratio;
            ratio = width_ratio;
            if (new_height > 400) {
                new_height = 400;
                var height_ratio = op.height / new_height;
                new_width = op.width / height_ratio;
                ratio = height_ratio
            }
            canvas2.item(0).set({
                top: 0,
                left: 0,
                scaleX: 1 / ratio,
                scaleY: 1 / ratio,
                selectable: false,
                hasControls: false,
                hasBorders: false,
                opacity: .7
            }).center().setCoords();
            canvas2.renderAll();
            if ($scope.cropToolMode) {
                var path = new fabric.Path(listPath.path_crop),
                    path2 = new fabric.Path(listPath.path_crop);
                $scope.currentPathCrop = listPath.path_crop;
                path.set({
                    originX: "center",
                    originY: "center",
                    scaleX: ratio,
                    scaleY: ratio,
                    fill: "#9bf0e9",
                    opacity: 0
                });
                path2.set({
                    originX: "center",
                    originY: "center",
                    opacity: 0,
                    hasRotatingPoint: false,
                    centeredScaling: true
                })
            } else {
                var path = new fabric.Path(listPath.path_1),
                    path2 = new fabric.Path(listPath.path_1);
                $scope.currentPathCrop = listPath.path_1;
                path.set({
                    originX: "center",
                    originY: "center",
                    scaleX: ratio * 3,
                    scaleY: ratio * 3,
                    fill: "#9bf0e9",
                    opacity: 0
                });
                path2.set({
                    originX: "center",
                    originY: "center",
                    opacity: 0,
                    scaleX: 3,
                    scaleY: 3,
                    hasRotatingPoint: false,
                    centeredScaling: true
                })
            }
            canvas2.renderAll();
            var op2 = new fabric.Image(originImg, {
                top: 0,
                left: 0,
                scaleX: 1 / ratio,
                scaleY: 1 / ratio,
                selectable: false,
                hasControls: false,
                hasBorders: false
            });
            canvas2.add(op2);
            var c = document.getElementById("shape_canvas");
            var _ctx = c.getContext("2d");
            var shape = canvas.item(1);
            canvas2.item(1).set({
                clipTo: function(ctx) {
                    path.render(ctx)
                }
            }).center().setCoords();
            canvas2.add(path2);
            canvas2.item(2).set({
                borderColor: "rgba(220, 220, 220, 1)"
            });
            canvas2.item(2)["setControlVisible"]("tl", false);
            canvas2.item(2)["setControlVisible"]("bl",
                false);
            canvas2.item(2).center().setCoords();
            canvas2.setActiveObject(canvas2.item(2));
            canvas2.renderAll()
        };
        originImg.src = url
    };
    $scope.cropImage = function() {
        var _url = "";
        if ($scope.canvas.item($scope.editableItem).get("type") == "image") _url = $scope.canvas.item($scope.editableItem).getSvgSrc();
        if ($scope.canvas.item($scope.editableItem).get("type") == "custom-image") _url = $scope.canvas.item($scope.editableItem).get("origin_src");
        var url = _url,
            width = canvas2.item(2).get("width"),
            height = canvas2.item(2).get("height"),
            scaleX = canvas2.item(2).get("scaleX"),
            left = canvas2.item(2).get("left"),
            top = canvas2.item(2).get("top"),
            i_top = canvas2.item(1).get("top"),
            i_left = canvas2.item(1).get("left"),
            ratio = 1 / canvas2.item(0).get("scaleX");
        canvas2.remove(canvas2.item(0));
        canvas2.remove(canvas2.item(2));
        var length = canvas2.getObjects().length;
        while (length > 1) {
            canvas2.remove(canvas2.item(1));
            length = canvas2.getObjects().length
        }
        canvas2.item(0).set({
            "left": scaleX * width / 2 - left + i_left,
            "top": scaleX * height / 2 - top + i_top
        });
        canvas2.setDimensions({
            "width": scaleX *
                width * ratio,
            "height": scaleX * height * ratio
        });
        canvas2.calcOffset();
        canvas2.setZoom(ratio);
        canvas2.renderAll();
        var img = new Image;
        img.src = canvas2.deactivateAll().toDataURL();
        img.onload = function() {
            var f_img = new fabric.CustomImage(img, {
                "origin_src": url
            });
            $scope.canvas.remove($scope.canvas.getActiveObject());
            $scope.canvas.add(f_img);
            var op_width = scaleX * width * ratio,
                op_height = scaleX * height * ratio;
            jQuery("#dg-crop-image").modal("hide");
            var max_width = $scope.canvas.width * .7;
            var max_height = $scope.canvas.height *
                .7;
            var new_width = max_width;
            if (op_width < max_width) new_width = op_width;
            var width_ratio = new_width / op_width;
            var new_height = op_height * width_ratio;
            if (new_height > max_height) {
                new_height = max_height;
                var height_ratio = new_height / op_height;
                new_width = op_width * height_ratio
            }
            var index = $scope.canvas.getObjects().length - 1;
            $scope.canvas.setActiveObject($scope.canvas.item(index));
            $scope.addLayers($scope.canvas.getActiveObject(), "custom-image", index);
            $scope.canvas.getActiveObject().set({
                scaleX: new_width / op_width,
                scaleY: new_height /
                    op_height
            }).center().setCoords();
            $scope.drawCanvas()
        }
    };
    $scope.lassoTool = function() {
        $scope.cropToolMode = true;
        $scope.clipPathMode = false;
        canvas2.remove(canvas2.item(2));
        canvas2.item(1).set({
            clipTo: function(ctx) {
                ctx.rect(0, 0, 0, 0)
            }
        });
        canvas2.renderAll();
        canvas2.isDrawingMode = true;
        $scope.freeDrawingMode = "Pencil";
        canvas2.freeDrawingBrush = new fabric["PencilBrush"](canvas2)
    };
    $scope.cropTool = function() {
        $scope.cropToolMode = true;
        $scope.clipPathMode = false;
        $scope.currentPathCrop = listPath.path_crop;
        path2 = new fabric.Path($scope.currentPathCrop);
        path2.set({
            originX: "center",
            originY: "center",
            opacity: 0,
            hasRotatingPoint: false,
            centeredScaling: true
        });
        canvas2.remove(canvas2.item(2));
        canvas2.add(path2);
        canvas2.item(2).center().setCoords();
        canvas2.item(2)["setControlVisible"]("tl", false);
        canvas2.item(2)["setControlVisible"]("bl", false);
        canvas2.setActiveObject(canvas2.item(2));
        canvas2.renderAll()
    };
    $scope.clipPath = function(type) {
        var index = "path_" + type;
        $scope.currentPathCrop = listPath[index];
        path2 = new fabric.Path($scope.currentPathCrop);
        path2.set({
            originX: "center",
            originY: "center",
            opacity: 0,
            hasRotatingPoint: false,
            scaleX: 3,
            scaleY: 3,
            centeredScaling: true
        });
        canvas2.remove(canvas2.item(2));
        canvas2.add(path2);
        canvas2.item(2).center().setCoords();
        canvas2.item(2)["setControlVisible"]("tl", false);
        canvas2.item(2)["setControlVisible"]("bl", false);
        canvas2.setActiveObject(canvas2.item(2));
        canvas2.renderAll()
    };
    $scope.toggleLockLayer = function(layer) {
        var bool = !$scope.canvas.item(layer.index).get("selectable"),
            id = "#layer-" + layer.index,
            lock = $scope.canvas.item(layer.index).get("forceLock");
        if($scope.task !== 'admindesign'){
           if(lock) return;
        }else{
            $scope.canvas.item(layer.index).set({
                "forceLock" : !lock
            });             
        }
        $scope.canvas.item(layer.index).set({
            selectable: bool
        });
        if (bool) {
            jQuery(id).removeClass("lock");
            jQuery(id + " .nbdesigner_lock_layer i").removeClass("fa-lock");
            jQuery(id + " .nbdesigner_lock_layer i").addClass("fa-unlock-alt")
        } else {
            jQuery(id).addClass("lock");
            jQuery(id + " .nbdesigner_lock_layer i").addClass("fa-lock");
            jQuery(id + " .nbdesigner_lock_layer i").removeClass("fa-unlock-alt")
        }
        $scope.canvas.deactivateAll();
        $scope.drawCanvas()
    };
    $scope.lockItem = function(command){
        var object = $scope.canvas.getActiveObject();
        if (object == null) return;        
        switch(command) {
            case "a" :
                var index = $scope.canvas.getObjects().indexOf($scope.canvas.getActiveObject());
                $scope.toggleLockLayer({'index' : index});
                break;
            case "x" :
                var val = ! object.get("lockMovementX");
                object.set({
                    lockMovementX : val
                });
                break;    
            case "y" :
                var val = ! object.get("lockMovementY");
                object.set({
                    lockMovementY : val
                });
                break;       
            case "sx" :
                var val = ! object.get("lockScalingX");
                object.set({
                    lockScalingX : val
                });
                break;     
            case "sy" :
                var val = ! object.get("lockScalingY");
                object.set({
                    lockScalingY : val
                });
                break;    
            case "r" :
                var val = ! object.get("lockRotation");
                object.set({
                    lockRotation : val
                });
                break;             
            default: break;
        }
        $scope.getStatusItem();
    };
    $scope.getStatusItem = function(){
        var object = $scope.canvas.getActiveObject();
        if (object == null) return;         
        $scope.editable.lockMovementX = object.get('lockMovementX');
        $scope.editable.lockMovementY = object.get('lockMovementY');
        $scope.editable.lockScalingX = object.get('lockScalingX');
        $scope.editable.lockScalingY = object.get('lockScalingY');
        $scope.editable.lockRotation = object.get('lockRotation');
        $scope.editable.selectable = object.get('selectable');           
    };
    $scope.toggleVisibleLayer = function(layer){
        var bool = !$scope.canvas.item(layer.index).get("visible"),
            id = "#layer-" + layer.index;
        $scope.canvas.item(layer.index).set({
            visible: bool
        });   
        if (bool) {
            jQuery(id).removeClass("lock");
            jQuery(id).addClass("active");
            jQuery(id + " .nbdesigner_visible_layer i").addClass("fa-eye");
            jQuery(id + " .nbdesigner_visible_layer i").removeClass("fa-eye-slash")
        } else {
            jQuery(id).addClass("lock");
            jQuery(id).removeClass("active");
            jQuery(id + " .nbdesigner_visible_layer i").removeClass("fa-eye");
            jQuery(id + " .nbdesigner_visible_layer i").addClass("fa-eye-slash")            
        }
        $scope.canvas.deactivateAll();
        $scope.drawCanvas()        
    };
    $scope.duplicateItem = function() {
        var object = canvas.getActiveObject();
        if (object == null) return;
        var obj = fabric.util.object.clone(object);
        $scope.canvas.add(obj);
        var index = $scope.canvas.getObjects().length - 1;
        $scope.canvas.deactivateAll();
        $scope.canvas.setActiveObject($scope.canvas.item(index));
        $scope.drawCanvas();
        $scope.updateCurrentLayerAfterDelete();
    };
    $scope.setUndoRedo = function(undo, redo){
        if (undo) {
            if(angular.isUndefined($scope.undos[$scope.currentVariant.orientationActive])) $scope.undos[$scope.currentVariant.orientationActive] = [];
            $scope.undos[$scope.currentVariant.orientationActive].push(undo);
            if ($scope.undos[$scope.currentVariant.orientationActive].length > 20) {
                $scope.undos[$scope.currentVariant.orientationActive].shift();
            }
        }
        if (redo) {
            if(angular.isUndefined($scope.redos[$scope.currentVariant.orientationActive])) $scope.redos[$scope.currentVariant.orientationActive] = [];
            $scope.redos[$scope.currentVariant.orientationActive].push(redo);
        }  
        $scope.updateCurrentLayerAfterDelete();
        $scope.updateUndoRedoStatus();
    };   
    $scope.clearHistory = function(){
        $scope.undos[$scope.currentVariant.orientationActive] = [];
        $scope.redos[$scope.currentVariant.orientationActive] = [];
        $scope.updateUndoRedoStatus();        
    };
    $scope.undoDesign = function(){
        if($scope.undos[$scope.currentVariant.orientationActive].length > 0) {
            var last = $scope.undos[$scope.currentVariant.orientationActive].pop();
            var _parameters = last.parameters;            
            if(last.interaction === 'remove') {
                $scope.canvas.add(last.element);
                last.interaction = 'add';
            }
            else if(last.interaction === 'add') {
                var item = $scope.canvas.item($scope.getItemById(last.element.itemId));
                $scope.canvas.remove(item);
                last.interaction = 'remove';
            }else {                
                var item = $scope.canvas.item($scope.getItemById(last.element.itemId));
                var parameters = JSON.parse(_parameters);
                _.each(parameters, function(val, key) {
                    parameters[key] = item.get(key);
                });
                _parameters = JSON.stringify(parameters);
                $scope.setItemParameters(last.parameters, last.element.itemId);  
            }
            $scope.setUndoRedo(false, {
                element: last.element,
                parameters: _parameters,
                interaction: last.interaction
            }); 
            $scope.drawCanvas();
        }
    };
    $scope.redoDesign = function(){
        if($scope.redos[$scope.currentVariant.orientationActive].length > 0) {
            var last = $scope.redos[$scope.currentVariant.orientationActive].pop();
            var _parameters = last.parameters;            
            if(last.interaction === 'remove') {
                $scope.canvas.add(last.element);
                last.interaction = 'add';
            }
            else if(last.interaction === 'add') {
                var item = $scope.canvas.item($scope.getItemById(last.element.itemId));
                $scope.canvas.remove(item);
                last.interaction = 'remove';
            }else {
                var item = $scope.canvas.item($scope.getItemById(last.element.itemId));
                var parameters = JSON.parse(_parameters);
                _.each(parameters, function(val, key) {
                    parameters[key] = item.get(key);
                });
                _parameters = JSON.stringify(parameters);                
                $scope.setItemParameters(last.parameters, last.element.itemId);
            }
            $scope.setUndoRedo({
                element: last.element,
                parameters: _parameters,
                interaction: last.interaction
            });
            $scope.drawCanvas();
        }
    };  
    $scope.getItemJson = function(item, params){
        if(params){
            return JSON.stringify(params);
        }else{
            return JSON.stringify(item);
        }
    };
    $scope.setItemParameters = function(parameters, itemId){
        var params = JSON.parse(parameters);
        var item = $scope.canvas.item($scope.getItemById(itemId));
        if(typeof params.src !== "undefined"){
            fabric.Image.fromURL(params.src, function(op) {
                item.getElement().setAttribute("src", params.src);  
                $scope.updateCurrentLayerAfterDelete();
                setTimeout(function(){ $scope.drawCanvas(); }, 1);
            })	            
        }        
        item.set(params);  
        item.setCoords();
    };
    $scope.updateUndoRedoStatus = function(){
        $scope.orientationActiveUndoStatus = false;
        $scope.orientationActiveRedoStatus = false;
        if(angular.isDefined($scope.undos[$scope.currentVariant.orientationActive])){ 
            if($scope.undos[$scope.currentVariant.orientationActive].length > 0){
                $scope.orientationActiveUndoStatus = true;
            }
        }      
        if(angular.isDefined($scope.redos[$scope.currentVariant.orientationActive])){ 
            if($scope.redos[$scope.currentVariant.orientationActive].length > 0){
                $scope.orientationActiveRedoStatus = true;
            }
        }      
    }; 
    $scope.getItemById = function(id){
        var len = $scope.canvas.getObjects().length;       
        for (var i = 0; i < len; i++) {
            if($scope.canvas.item(i).get('itemId') == id) return i;
        }        
    };    
    $scope.setElementUpload = function(){
        if ($scope.editableItem == null) return;
        var object = $scope.canvas.item($scope.editableItem);
        if (object.type === "image" || object.type === "custom-image"){
            if(typeof object.elementUpload  === 'undefined'){
                object.set({'elementUpload' : true});
            }else {
                var hasUpload = !object.elementUpload;
                object.set({'elementUpload' : hasUpload});
            }         
            $scope.updatePositionReplaceButton();
        }
        return;
    };
    $scope.updatePositionReplaceButton = function(){       
        var object = $scope.canvas.item($scope.editableItem);
        $('#replace-element-upload').hide();
        if (object.type === "image" || object.type === "custom-image") {
            if(typeof object.elementUpload !== 'undefined'){
                if(object.elementUpload){
                    var left = object.left + 10,
                    top = object.top + 10;
                    if(left < 10) left = 10;
                    if(top < 10) top = 10;
                    left = left + $scope.calcLeft($scope.currentVariant.designArea['area_design_left']);
                    top = top + $scope.calcLeft($scope.currentVariant.designArea['area_design_top']);
                    $('#replace-element-upload').css({
                        left: left + "px",
                        top: top + "px"   
                    }).show();
                }
            }	
        }
        return;
    };
    $scope.preReplaceImage = function(){
        $scope.readyReplaceImage = true;
        $('#dg-myclipart').modal('show');
        //$('#upload-tabs a[href="#uploaded-photo"]').tab("show");
        
    };
    $scope.initParams = function(){
        _.each(NBDSETTINGS, function(value, index){
            $scope.uiLayout[index] = value;
        });  
        _.each(NBDESIGNCONFIG, function(value, index){
            $scope.settings[index] = value;
        })        
    }
    $scope.init = function() {
        show_indicator();
        $scope.initParams();
        if (!checkNavigator()) {
            hide_indicator();
            return
        }
        $scope.canvas = canvas;
        $scope.loaded = 0;
        $scope.loadSource();
        $scope.loadLanguage();
        if(OD_temp != ''){
            $scope.loadProduct(product_id, 0, OD_temp);   
        }else{
            $scope.loadProduct(product_id, 0, 'primary');   
        }
        $scope.initBrushes();
        var log = "c"+"o"+"n"+"s"+"o"+"l"+"e.i"+"n"+"f"+"o('%cP"+"o"+"we"+"r"+"e"+"d b"+"y %cN"+"E"+"T%cB"+"A"+"S"+"E%cT"+"E"+"A"+"M', 'color: orange; font-size: 20px;', 'color: red; font-size: 40px;', 'color: green; font-size: 40px;', 'color: #F48024; font-size: 40px;')";
        //eval(log);
        if (checkFireFox() || checkIE()) jQuery("input.jscolor").removeAttr("disabled")
    };
    $scope.init();
    $scope.debug = function() {
//        $scope.canvas.item(0).foo = JSON.stringify({'attr' : 'bar', 'pro' : 'foo'});
//        var json = JSON.stringify($scope.canvas.toJSON(['foo'])); 
//        $scope.canvas.clear();
//        $scope.canvas.loadFromJSON(json);
//        console.log(json);
//        var itemConfig = {
//            'clickToUpload' : false,
//            'rtl' : false,
//            'lockMovementX' : false,
//            'lockMovementY' : false,
//            'lockScalingX' : false,
//            'lockScalingY' : false,
//            'lockRotation' : false
//        };
//        var con = {
//            'lockMovementY' : true
//        }
        //console.log(_.merge(config, con));
       //console.log($scope.canvas.getActiveObject());
//       console.log($scope.canvas.getObjects());
//       console.log($scope.undos);
//       console.log($scope.redos);
     //console.log($scope.readyReplaceImage);
        //console.log(canvas.toSVG());
       // console.log(/\.(jpg|gif|png)$/.test('http://metoprint.net/wp-content/uploads/2015/09/RegBC-600x600.png'));
       //$scope.addImage('http://dev.cmsmart.net:3000/wp46/wp-content/uploads/2016/09//dg-designer-672d30ab14605384591193679101058126.png');
       //$scope.partialSave = !$scope.partialSave;
       
       //var code = 'data:image/png;base64,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/GMzLdsAAD6GaVRYdFhNTDpjb20uYWRvYmUueG1wAAAAAAA8P3hwYWNrZXQgYmVnaW49Iu+7vyIgaWQ9Ilc1TTBNcENlaGlIenJlU3pOVGN6a2M5ZCI/Pgo8eDp4bXBtZXRhIHhtbG5zOng9ImFkb2JlOm5zOm1ldGEvIiB4OnhtcHRrPSJBZG9iZSBYTVAgQ29yZSA1LjUtYzAxNCA3OS4xNTE0ODEsIDIwMTMvMDMvMTMtMTI6MDk6MTUgICAgICAgICI+CiAgIDxyZGY6UkRGIHhtbG5zOnJkZj0iaHR0cDovL3d3dy53My5vcmcvMTk5OS8wMi8yMi1yZGYtc3ludGF4LW5zIyI+CiAgICAgIDxyZGY6RGVzY3JpcHRpb24gcmRmOmFib3V0PSIiCiAgICAgICAgICAgIHhtbG5zOnhtcD0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wLyIKICAgICAgICAgICAgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iCiAgICAgICAgICAgIHhtbG5zOnN0RXZ0PSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VFdmVudCMiCiAgICAgICAgICAgIHhtbG5zOnBob3Rvc2hvcD0iaHR0cDovL25zLmFkb2JlLmNvbS9waG90b3Nob3AvMS4wLyIKICAgICAgICAgICAgeG1sbnM6ZGM9Imh0dHA6Ly9wdXJsLm9yZy9kYy9lbGVtZW50cy8xLjEvIgogICAgICAgICAgICB4bWxuczp0aWZmPSJodHRwOi8vbnMuYWRvYmUuY29tL3RpZmYvMS4wLyIKICAgICAgICAgICAgeG1sbnM6ZXhpZj0iaHR0cDovL25zLmFkb2JlLmNvbS9leGlmLzEuMC8iPgogICAgICAgICA8eG1wOkNyZWF0b3JUb29sPkFkb2JlIFBob3Rvc2hvcCBDQyAoV2luZG93cyk8L3htcDpDcmVhdG9yVG9vbD4KICAgICAgICAgPHhtcDpDcmVhdGVEYXRlPjIwMTctMDItMjFUMTY6MDY6MzIrMDc6MDA8L3htcDpDcmVhdGVEYXRlPgogICAgICAgICA8eG1wOk1ldGFkYXRhRGF0ZT4yMDE3LTAyLTIxVDE2OjA2OjMyKzA3OjAwPC94bXA6TWV0YWRhdGFEYXRlPgogICAgICAgICA8eG1wOk1vZGlmeURhdGU+MjAxNy0wMi0yMVQxNjowNjozMiswNzowMDwveG1wOk1vZGlmeURhdGU+CiAgICAgICAgIDx4bXBNTTpJbnN0YW5jZUlEPnhtcC5paWQ6MjM2ODA0ZGQtN2M1ZC00NjQ1LWJjYmMtZTdlNjg0Y2E1N2FkPC94bXBNTTpJbnN0YW5jZUlEPgogICAgICAgICA8eG1wTU06RG9jdW1lbnRJRD54bXAuZGlkOjI3YjY5YjAwLTkzMTUtYmI0NS04ZmRlLTQ0NjY1OWIzZjAzODwveG1wTU06RG9jdW1lbnRJRD4KICAgICAgICAgPHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD54bXAuZGlkOjI3YjY5YjAwLTkzMTUtYmI0NS04ZmRlLTQ0NjY1OWIzZjAzODwveG1wTU06T3JpZ2luYWxEb2N1bWVudElEPgogICAgICAgICA8eG1wTU06SGlzdG9yeT4KICAgICAgICAgICAgPHJkZjpTZXE+CiAgICAgICAgICAgICAgIDxyZGY6bGkgcmRmOnBhcnNlVHlwZT0iUmVzb3VyY2UiPgogICAgICAgICAgICAgICAgICA8c3RFdnQ6YWN0aW9uPmNyZWF0ZWQ8L3N0RXZ0OmFjdGlvbj4KICAgICAgICAgICAgICAgICAgPHN0RXZ0Omluc3RhbmNlSUQ+eG1wLmlpZDoyN2I2OWIwMC05MzE1LWJiNDUtOGZkZS00NDY2NTliM2YwMzg8L3N0RXZ0Omluc3RhbmNlSUQ+CiAgICAgICAgICAgICAgICAgIDxzdEV2dDp3aGVuPjIwMTctMDItMjFUMTY6MDY6MzIrMDc6MDA8L3N0RXZ0OndoZW4+CiAgICAgICAgICAgICAgICAgIDxzdEV2dDpzb2Z0d2FyZUFnZW50PkFkb2JlIFBob3Rvc2hvcCBDQyAoV2luZG93cyk8L3N0RXZ0OnNvZnR3YXJlQWdlbnQ+CiAgICAgICAgICAgICAgIDwvcmRmOmxpPgogICAgICAgICAgICAgICA8cmRmOmxpIHJkZjpwYXJzZVR5cGU9IlJlc291cmNlIj4KICAgICAgICAgICAgICAgICAgPHN0RXZ0OmFjdGlvbj5zYXZlZDwvc3RFdnQ6YWN0aW9uPgogICAgICAgICAgICAgICAgICA8c3RFdnQ6aW5zdGFuY2VJRD54bXAuaWlkOjIzNjgwNGRkLTdjNWQtNDY0NS1iY2JjLWU3ZTY4NGNhNTdhZDwvc3RFdnQ6aW5zdGFuY2VJRD4KICAgICAgICAgICAgICAgICAgPHN0RXZ0OndoZW4+MjAxNy0wMi0yMVQxNjowNjozMiswNzowMDwvc3RFdnQ6d2hlbj4KICAgICAgICAgICAgICAgICAgPHN0RXZ0OnNvZnR3YXJlQWdlbnQ+QWRvYmUgUGhvdG9zaG9wIENDIChXaW5kb3dzKTwvc3RFdnQ6c29mdHdhcmVBZ2VudD4KICAgICAgICAgICAgICAgICAgPHN0RXZ0OmNoYW5nZWQ+Lzwvc3RFdnQ6Y2hhbmdlZD4KICAgICAgICAgICAgICAgPC9yZGY6bGk+CiAgICAgICAgICAgIDwvcmRmOlNlcT4KICAgICAgICAgPC94bXBNTTpIaXN0b3J5PgogICAgICAgICA8cGhvdG9zaG9wOlRleHRMYXllcnM+CiAgICAgICAgICAgIDxyZGY6QmFnPgogICAgICAgICAgICAgICA8cmRmOmxpIHJkZjpwYXJzZVR5cGU9IlJlc291cmNlIj4KICAgICAgICAgICAgICAgICAgPHBob3Rvc2hvcDpMYXllck5hbWU+d29yZHByZXNzIHByaW50c2hvcDwvcGhvdG9zaG9wOkxheWVyTmFtZT4KICAgICAgICAgICAgICAgICAgPHBob3Rvc2hvcDpMYXllclRleHQ+d29yZHByZXNzIHByaW50c2hvcDwvcGhvdG9zaG9wOkxheWVyVGV4dD4KICAgICAgICAgICAgICAgPC9yZGY6bGk+CiAgICAgICAgICAgIDwvcmRmOkJhZz4KICAgICAgICAgPC9waG90b3Nob3A6VGV4dExheWVycz4KICAgICAgICAgPHBob3Rvc2hvcDpEb2N1bWVudEFuY2VzdG9ycz4KICAgICAgICAgICAgPHJkZjpCYWc+CiAgICAgICAgICAgICAgIDxyZGY6bGk+OUM1Q0YxNzI3NTgxQTExRDQ3NzFDMjc0NjI3QUE0RDU8L3JkZjpsaT4KICAgICAgICAgICAgICAgPHJkZjpsaT5DNkM2OTE0RTMyRjY3MDFDQkY2MUFBMTIyRkZGMTI0NjwvcmRmOmxpPgogICAgICAgICAgICAgICA8cmRmOmxpPkRENjgwNTkwNTFFRjY2NzM5QjkxNDM0OEEwMTg3MUEwPC9yZGY6bGk+CiAgICAgICAgICAgICAgIDxyZGY6bGk+YWRvYmU6ZG9jaWQ6cGhvdG9zaG9wOmY0ODFiOTVkLWY0YmEtMTFlNi1iOWZjLWE2N2RiY2UyZTI1MTwvcmRmOmxpPgogICAgICAgICAgICAgICA8cmRmOmxpPnhtcC5kaWQ6OGY0MmZiYmItY2RjNS00YmEyLWJjMjQtYWIyOWQ5MDQ4NWIzPC9yZGY6bGk+CiAgICAgICAgICAgICAgIDxyZGY6bGk+eG1wLmRpZDo4ZmFkZDY4OC0yMDE1LTRkNDgtOTMyYi1kNjFmNmE1ZGE0NzE8L3JkZjpsaT4KICAgICAgICAgICAgICAgPHJkZjpsaT54bXAuZGlkOkM2OTVENTRBNkU4RjExRTVBMTg1OTNCOEUwNzA3RTlDPC9yZGY6bGk+CiAgICAgICAgICAgICAgIDxyZGY6bGk+eG1wLmRpZDpjMGQ3YmFlZC1mMjdkLTQwMjQtYWMyMS05ZmUzMTUwZTRmMGU8L3JkZjpsaT4KICAgICAgICAgICAgICAgPHJkZjpsaT54bXAuZGlkOmQ0ZDQyNzE4LTEzMmMtOWM0OS1hNTMzLTEzMmQ3NTlmM2MzOTwvcmRmOmxpPgogICAgICAgICAgICA8L3JkZjpCYWc+CiAgICAgICAgIDwvcGhvdG9zaG9wOkRvY3VtZW50QW5jZXN0b3JzPgogICAgICAgICA8cGhvdG9zaG9wOkNvbG9yTW9kZT4zPC9waG90b3Nob3A6Q29sb3JNb2RlPgogICAgICAgICA8cGhvdG9zaG9wOklDQ1Byb2ZpbGU+c1JHQiBJRUM2MTk2Ni0yLjE8L3Bob3Rvc2hvcDpJQ0NQcm9maWxlPgogICAgICAgICA8ZGM6Zm9ybWF0PmltYWdlL3BuZzwvZGM6Zm9ybWF0PgogICAgICAgICA8dGlmZjpPcmllbnRhdGlvbj4xPC90aWZmOk9yaWVudGF0aW9uPgogICAgICAgICA8dGlmZjpYUmVzb2x1dGlvbj43MjAwMDAvMTAwMDA8L3RpZmY6WFJlc29sdXRpb24+CiAgICAgICAgIDx0aWZmOllSZXNvbHV0aW9uPjcyMDAwMC8xMDAwMDwvdGlmZjpZUmVzb2x1dGlvbj4KICAgICAgICAgPHRpZmY6UmVzb2x1dGlvblVuaXQ+MjwvdGlmZjpSZXNvbHV0aW9uVW5pdD4KICAgICAgICAgPGV4aWY6Q29sb3JTcGFjZT4xPC9leGlmOkNvbG9yU3BhY2U+CiAgICAgICAgIDxleGlmOlBpeGVsWERpbWVuc2lvbj4xNjQ8L2V4aWY6UGl4ZWxYRGltZW5zaW9uPgogICAgICAgICA8ZXhpZjpQaXhlbFlEaW1lbnNpb24+MTEyPC9leGlmOlBpeGVsWURpbWVuc2lvbj4KICAgICAgPC9yZGY6RGVzY3JpcHRpb24+CiAgIDwvcmRmOlJERj4KPC94OnhtcG1ldGE+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgCjw/eHBhY2tldCBlbmQ9InciPz5zoAJDAAAAIGNIUk0AAHolAACAgwAA+f8AAIDpAAB1MAAA6mAAADqYAAAXb5JfxUYAAH8jSURBVHja7P1Xr2VZlqWJfUtsdfS5+pp2N1fhkREZmdnZmZ0lWqAbRDfAfiEaIAi+8DcQaIBPBP8Igf4VJBrgA8FiVVdlVlRGRoSHcGXa7Oojtl6KD2ufcy0o3vnQHgiYubuZ2zl7zzXXnGOOMaYIIQT+57/+57/+/+QvDfDf/+//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';
       //NBDESIGNERCART.test(code);
        
        //console.log($scope.currentVariant.activeImages);
        //console.log($scope.uiLayout);
        NBDESIGNERFUNC.debug();
        //$scope.loadProduct('');   
    };
    $scope.changeBackgroundId = function(n){
        $scope.backgroundId = n;
    };
    $scope.state = "dev";
    window.scope = $scope
});
angular.module("app").factory("ArtService", function($http) {
    return {
        fn: function(callback) {
            if ($("#loading_art_upload").hasClass("hidden")) $("#loading_art_upload").removeClass("hidden");
            $http({
                method: "POST",
                url: window.parent.nbds_frontend.url,
                params: {
                    action: "nbdesigner_get_art",
                    nonce: window.parent.nbds_frontend.nonce_get
                }
            }).success(function(data, status, headers, config) {
                callback(data);
                if (!$("#loading_art_upload").hasClass("hidden")) $("#loading_art_upload").addClass("hidden")
            }).error(function(data, status,
                headers, config) {
                alert("Error! Try again!");
                if (!$("#loading_art_upload").hasClass("hidden")) $("#loading_art_upload").addClass("hidden")
            })
        }
    }
});
angular.module("app").factory("FontService", function($http) {
    return {
        fn: function(callback) {
            if ($("#loading_font_upload").hasClass("hidden")) $("#loading_font_upload").removeClass("hidden");
            $http({
                method: "POST",
                url: window.parent.nbds_frontend.url,
                params: {
                    action: "nbdesigner_get_font",
                    nonce: window.parent.nbds_frontend.nonce_get
                }
            }).success(function(data, status, headers, config) {
                callback(data);
                if (!$("#loading_font_upload").hasClass("hidden")) $("#loading_font_upload").addClass("hidden")
            }).error(function(data,
                status, headers, config) {
                alert("Error! Try again!");
                if (!$("#loading_font_upload").hasClass("hidden")) $("#loading_font_upload").addClass("hidden")
            })
        }
    }
});
angular.module("app").factory("PatternService", function($q, $http) {
    return {
        fn: function(callback) {
            if ($("#loading_pattern").hasClass("hidden")) $("#loading_pattern").removeClass("hidden");
            $http({
                method: "POST",
                url: window.parent.nbds_frontend.url,
                params: {
                    action: "nbdesigner_get_pattern",
                    nonce: window.parent.nbds_frontend.nonce_get
                }
            }).success(function(data, status, headers, config) {
                callback(data);
                if (!$("#loading_pattern").hasClass("hidden")) $("#loading_pattern").addClass("hidden")
            }).error(function(data, status, headers, config) {
                alert("Error! Try again!");
                if (!$("#loading_pattern").hasClass("hidden")) $("#loading_pattern").addClass("hidden")
            })
        }
    }
});
angular.module("app").service("PriceService", function() {});
angular.module("app").service("ProductService", function($http, $q) {
    this.getProduct = function(id, variation, template) {
        var deferred = $q.defer();
        $http({
            url: window.parent.nbds_frontend.url,
            method: "POST",
            data: "action=nbdesigner_get_product_info&nonce=" + window.parent.nbds_frontend.nonce + "&id=" + id + "&oid=" + orderid + '&did=' + template + '&variation=' + variation + '&ref=' + OD_ref + '&folder=' + OD_folder,
            headers: {
                "Content-Type": "application/x-www-form-urlencoded",
                "Cache-Control" : "no-cache"
            }
        }).success(function(data, status, headers, config) {
            deferred.resolve(data)
        }).error(function(data, status, headers, config) {
            deferred.reject(data)
        });
        return deferred.promise
    }
});
angular.module("app").factory("QrcodeService", function($http) {
    return {
        fn: function(data, callback) {
            $("#loading_qrcode").removeClass("hidden");
            $http({
                method: "POST",
                url: window.parent.nbds_frontend.url,
                params: {
                    data: data,
                    action: "nbdesigner_get_qrcode",
                    nonce: window.parent.nbds_frontend.nonce
                }
            }).success(function(data, status, headers, config) {
                callback(data);
                $("#loading_qrcode").addClass("hidden")
            }).error(function(data, status, headers, config) {
                $("#loading_qrcode").addClass("hidden");
                alert("Error! Try again!")
            })
        }
    }
});
angular.module("app").service("LanguageService", function($http, $q) {
    this.getLang = function(code) {
        var deferred = $q.defer();
        $http({
            url: window.parent.nbds_frontend.url,
            method: "POST",
            data: "action=nbdesigner_get_language&nonce=" + window.parent.nbds_frontend.nonce + "&code=" + code ,
            headers: {
                "Content-Type": "application/x-www-form-urlencoded"
            }            
        }).success(function(data, status, headers, config) {
            deferred.resolve(data)
        }).error(function(data, status, headers, config) {
            deferred.reject(data)
        });
        return deferred.promise;
    };   
});
angular.module("app").service("AdminTemplateService", function($http, $q) {
    this.getDesign = function(id) {
        var deferred = $q.defer();
        $http({
            url: window.parent.nbds_frontend.url,
            method: "POST",
            data: "action=nbdesigner_load_admin_design&nonce=" + window.parent.nbds_frontend.nonce + "&id=" + id ,
            headers: {
                "Content-Type": "application/x-www-form-urlencoded"
            }            
        }).success(function(data, status, headers, config) {
            deferred.resolve(data)
        }).error(function(data, status, headers, config) {
            deferred.reject(data)
        });
        return deferred.promise;
    };   
});
var NBDESIGNERCART = {
    dataImage: {},
    dataJson: {},
    thumbs: [],
    flag: 0,
    initData: function(image, json, flag){
        console.time("save_partial");
        this.dataImage = image;
        this.dataJson = json;
        this.flag = flag;   
        jQuery('#total_sides').html(_.size(this.dataImage));
    },
    resetData: function(){
        this.dataImage = {};
        this.dataJson = {};
        this.flag = 0;
        this.thumbs = []; 
        jQuery('#total_sides').html("1");
    },
    upload_design: function(data_img, data_json, fonts, config) {
        show_indicator();
        data_json = JSON.stringify(data_json);       
        _fonts = JSON.stringify(fonts);   
        _config = JSON.stringify(config);
        var data = {
            "img": data_img,
            "json": data_json
        };
        jQuery.ajax({
            url: window.parent.nbds_frontend.url,
            method: "POST",
            data: {
                "action": "nbdesigner_save_customer_design",
                "image": data,
                "nonce": window.parent.nbds_frontend.nonce,
                "sid": window.parent.nbds_frontend.sid,
                "adid": adid,
                "product_id": product_id,
                "orderid": orderid,
                "task" : OD_task,
                "fonts" : _fonts,
                "config" : _config,
                "priority" : OD_priority,
                "save_status" : OD_save_status,
                "oiid" : OD_oiid,
                "folder" : OD_folder
            }
        }).done(function(data) {
            var _data = JSON.parse(data);
            if (_data.flag == "success") {
                window.parent.NBDESIGNERPRODUCT.show_design_thumbnail(_data.image);
                window.parent.hideDesignFrame();
                if(OD_task == '' && orderid == ''){
                    window.parent.NBDESIGNERPRODUCT.get_sugget_design(product_id);
                }
                if (_data.redesign != "") window.parent.hideDesignFrame(_data.redesign);
                else window.parent.hideDesignFrame()
            } else if (_data.flag == "pendding") {
                if (_data.redesign != "") window.parent.hideDesignFrame(_data.redesign)
            } else alert("Something wrong! Please try again...");
            OD_save_status = 1;
            hide_indicator()
        })
    },
    partial_upload: function(data_img, data_json, fonts, config) {
        var self = this;
        var key = "frame_" + self.flag;
        var dataimg = {};
        dataimg[key] = data_img[key];
        _fonts = JSON.stringify(fonts);   
        _config = JSON.stringify(config);        
        var data = {
            "img": dataimg
        };       
        var partial_data = {
            "action": "nbdesigner_save_partial_customer_design",
            "image": data,
            "nonce": window.parent.nbds_frontend.nonce,
            "sid": window.parent.nbds_frontend.sid,
            "product_id": product_id,
            "flag" : self.flag
        };
        if(self.flag == 0){
            partial_data['fonts'] = _fonts;
            partial_data['config'] = _config;
            data['json'] = JSON.stringify(data_json);
            show_indicator();
        }   
        jQuery.ajax({
            url: window.parent.nbds_frontend.url,
            method: "POST",
            data: partial_data
        }).done(function(data) {
            var _data = JSON.parse(data);
            if (_data.flag == "success") {
                var next_flag = parseInt(self.flag) + 1;
                jQuery('#saved_sides').html(next_flag);
                self.flag = next_flag;
                self.thumbs.push(_data.link);
                var next_key = "frame_" + self.flag;
                if (self.dataImage[next_key] && self.flag != 0) {
                    self.partial_upload(self.dataImage, self.dataJson, self.flag)
                } else {                    
                    window.parent.NBDESIGNERPRODUCT.show_design_thumbnail(self.thumbs);
                    window.parent.hideDesignFrame();
                    self.resetData();
                    console.timeEnd("save_partial");
                    hide_indicator()
                }
            } else if (_data.flag == "pendding") {
                if (_data.redesign != "") window.parent.hideDesignFrame(_data.redesign)
            } else {
                alert("Something wrong! Please try again...");
                hide_indicator()
            }
        })
    },
    upload_blod : function(data_img, data_json, fonts, config){
        show_indicator();
        _data_json = JSON.stringify(data_json);       
        _fonts = JSON.stringify(fonts);   
        _config = JSON.stringify(config);        
        var fd = new FormData();
        fd.append('action', 'nbdesigner_save_customer_design2');
        fd.append('nonce', window.parent.nbds_frontend.nonce);
        fd.append('sid', window.parent.nbds_frontend.sid);
        fd.append('adid', adid);
        fd.append('product_id', product_id);
        fd.append('task', OD_task);
        fd.append('priority', OD_priority);
        fd.append('save_status', OD_save_status);
        fd.append('oiid', OD_oiid);
        fd.append('orderid', orderid);
        fd.append('folder', OD_folder);      
        fd.append('json', _data_json);      
        fd.append('fonts', _fonts);      
        fd.append('config', _config);              
        _.each(data_img, function(val, key) {
            fd.append(key, makeblob(val));     
        });                
        jQuery.ajax({
            url: window.parent.nbds_frontend.url,
            method: "POST",   
            processData: false,
            contentType: false,                
            data: fd
        }).done(function(data){
            var _data = JSON.parse(data);
            if (_data.flag == "success") {
                window.parent.NBDESIGNERPRODUCT.show_design_thumbnail(_data.image);
                window.parent.hideDesignFrame();
                if(OD_task == '' && orderid == ''){
                    window.parent.NBDESIGNERPRODUCT.get_sugget_design(product_id);
                }
                if (_data.redesign != "") window.parent.hideDesignFrame(_data.redesign);
                else window.parent.hideDesignFrame()
            } else if (_data.flag == "pendding") {
                if (_data.redesign != "") window.parent.hideDesignFrame(_data.redesign)
            } else alert("Something wrong! Please try again...");
            OD_save_status = 1;
            hide_indicator()
        });         
    }
};
var makeblob = function (dataURL) {
    var BASE64_MARKER = ';base64,';
    if (dataURL.indexOf(BASE64_MARKER) == -1) {
        var parts = dataURL.split(',');
        var contentType = parts[0].split(':')[1];
        var raw = decodeURIComponent(parts[1]);
        return new Blob([raw], { type: contentType });
    }
    var parts = dataURL.split(BASE64_MARKER);
    var contentType = parts[0].split(':')[1];
    var raw = window.atob(parts[1]);
    var rawLength = raw.length;
    var uInt8Array = new Uint8Array(rawLength);
    for (var i = 0; i < rawLength; ++i) {
        uInt8Array[i] = raw.charCodeAt(i);
    }
    return new Blob([uInt8Array], { type: contentType });
} 
var nbdesigner_fb = function() {
    FB.getLoginStatus(function(response) {
        if (response.status === "connected") {
            var uid = response.authResponse.userID;
            var accessToken = response.authResponse.accessToken;
            console.log(accessToken);
            jQuery.ajax({
                url: window.parent.nbds_frontend.url,
                method: "POST",
                data: {
                    action: "nbdesigner_get_facebook_photo",
                    nonce: window.parent.nbds_frontend.nonce,
                    accessToken: accessToken
                },
                beforeSend: function() {},
                success: function(data) {
                    data = JSON.parse(data);
                    if (!!data.img) {
                        var html = "";
                        $.each(data.img, function(key,
                            value) {
                            html += '<img class="img-responsive img-thumbnail nbdesigner_upload_image shadow hover-shadow" data-url="" onclick="NBDESIGNERFUNC.addFacebookImage(\'' + value + '\', this)" src="' + value + '" />'
                        });
                        $("#uploaded-facebook").append(html)
                    }
                }
            })
        } else if (response.status === "not_authorized");
        else;
    })
};
var nbdesigner_fb1 = function() {
    $("#loading_fb_upload").removeClass("hidden");
    FB.getLoginStatus(function(response) {
        if (response.status === "connected") {
            var uid = response.authResponse.userID;
            var accessToken = response.authResponse.accessToken;
            var next = $("#nbdesigner_fb_next").val();
            if (next == "") var photo_json = "https://graph.facebook.com/" + uid + "/photos/uploaded/?limit=5&fields=source,images,link&access_token=" + accessToken;
            else photo_json = next;
            $.getJSON(photo_json, function() {
                console.log("Get album success!")
            }).done(function(data) {
                var photos = data.data;
                var html = "";
                $.each(photos, function(key, val) {
                    var src = "";
                    if (val.images) src = val.images[0].source;
                    else src = val.source;
                    html += '<img class="img-responsive img-thumbnail nbdesigner_upload_image shadow hover-shadow" data-url="" onclick="NBDESIGNERFUNC.addFacebookImage(\'' + src + '\', this)" src="' + src + '" />'
                });
                $("#uploaded-facebook").prepend(html);
                if (data.paging.next) {
                    $("#nbdesigner_fb_next").val(data.paging.next);
                    if ($("#facebook-load-more").hasClass("hidden")) $("#facebook-load-more").removeClass("hidden")
                } else {
                    $("#nbdesigner_fb_next").val("");
                    if (!$("#facebook-load-more").hasClass("hidden")) $("#facebook-load-more").addClass("hidden")
                }
                if (!$("#loading_fb_upload").hasClass("hidden")) $("#loading_fb_upload").addClass("hidden")
            }).fail(function() {
                if (!$("#loading_fb_upload").hasClass("hidden")) $("#loading_fb_upload").addClass("hidden")
            }).always(function() {
                if (!$("#loading_fb_upload").hasClass("hidden")) $("#loading_fb_upload").addClass("hidden")
            })
        }
    })
};
var NBDESIGNERFUNC = {
    addFacebookImage: function(url, e) {
        var _url = jQuery(e).attr('data-url');   
        var sefl = jQuery(e);
        var scope = angular.element(document.getElementById("designer-controller")).scope();       
        if(_url != ''){
            scope.addImage(_url)
        }else{
            show_indicator();
            jQuery.ajax({
                url: window.parent.nbds_frontend.url,
                method: "POST",
                data: {
                    "action": "nbdesigner_copy_image_from_url",
                    "nonce": window.parent.nbds_frontend.nonce,
                    "url": url
                }
            }).done(function(data) {
                data = JSON.parse(data);
                if(data['flag'] == 1){
                    sefl.attr('data-url', data['src']);
                    scope.addImage(data['src'])
                }else{
                    alert('Try to download image and then upload to our server!');
                    jQuery('#upload-tabs a[href="#upload-computer"]').tab("show");
                }
                hide_indicator()
            });             
        }       
        if (scope.$root.$$phase !== "$apply" && scope.$root.$$phase !== "$digest") scope.$apply()
    },
    addQrImage: function(url) {
        var scope = angular.element(document.getElementById("designer-controller")).scope();
        scope.addImage(url);
        if (scope.$root.$$phase !== "$apply" && scope.$root.$$phase !== "$digest") scope.$apply()
    },
    debug : function(){
        jQuery.ajax({
            url: window.parent.nbds_frontend.url,
            method: "POST",
            data : {
                action: "nbdesigner_get_product_info",
                nonce: window.parent.nbds_frontend.nonce,
                id: product_id
            }            
        }).done(function(data) {
            console.log(JSON.parse(data));
        });         
    }
};
angular.module("app").filter("reverse", function() {
    return function(items) {
        if (!angular.isArray(items)) return items;
        return items.slice().reverse()
    }
}).filter("startFrom", function() {
    return function(input, start) {
        start = +start;
        return input.slice(start)
    }
}).filter("filterCat", function() {
    return function(input, cat_id) {
        var output = [];
        _.each(input, function(val, key) {
            if (!val.cat) val.cat = ["99"];
            if (val.cat.length == 0) val.cat = ["0"];
            if ($.inArray(cat_id, val.cat) >= 0) output.push(val)
        });
        return output
    }
}).filter("range",function(){
  return function(input, total) {
    total = parseInt(total);
    for (var i=0; i<total; i++) {
      input.push(i);
    }
    return input;
  };
});
angular.module("app").directive("owlCarousel", function() {
    return {
        restrict: "E",
        transclude: false,
        link: function(scope) {
            scope.initCarousel = function(element) {
                var defaultOptions = {};
                var customOptions = scope.$eval($(element).attr("data-options"));
                for (var key in customOptions) defaultOptions[key] = customOptions[key];
                $(element).owlCarousel(defaultOptions)
            }
        }
    }
}).directive("owlCarouselItem", [function() {
    return {
        restrict: "A",
        transclude: false,
        link: function(scope, element) {
            if (scope.$last) scope.initCarousel(element.parent())
        }
    }
}]).directive("pathArtDirective", [function() {
    return function(scope, element, attrs) {
        if (scope.$last) {
            jscolor.installByClassName("jscolor");
            if (checkFireFox() || checkIE()) jQuery("input.jscolor").removeAttr("disabled")
        }
    }
}]);
jQuery(document).ready(function($){
    window.parent.jQuery('.variations_form.cart').on('change', function(){
        var variation_id = window.parent.jQuery('input[name="variation_id"]').val();
        var scope = angular.element(document.getElementById("designer-controller")).scope();
        if(variation_id != ''){
            window.parent.NBDESIGNERPRODUCT.nbdesigner_unready();
        }
        if(!scope.onLoadProduct && variation_id != ''){
            scope.loaded = 0;
            scope.onLoadProduct = true;
            show_indicator();
            scope.canvas.clear();
            scope.loadProduct(product_id, variation_id,  'primary');              
        }      
        if (scope.$root.$$phase !== "$apply" && scope.$root.$$phase !== "$digest") scope.$apply()
    });
    window.parent.jQuery('.reset_variations').on('click', function(){
        var scope = angular.element(document.getElementById("designer-controller")).scope();
        window.parent.NBDESIGNERPRODUCT.nbdesigner_unready();
        if(!scope.onLoadProduct){
            scope.loaded = 0;
            scope.onLoadProduct = true;
            show_indicator();
            scope.canvas.clear();
            scope.loadProduct(product_id, 0, 'primary');              
        }      
        if (scope.$root.$$phase !== "$apply" && scope.$root.$$phase !== "$digest") scope.$apply()
    });   
    window.parent.jQuery('#nbdesign-new-template').on('click', function(){
        OD_save_status = 0;
        var d = new Date();
        adid = d.getTime();
    });    
    window.parent.jQuery('#triggerDesign').on('click', function(){
        OD_save_status = 1;
        adid = NBDESIGNCONFIG['origin_foler_template'];
    });    
    $(document).bind('keydown', function(e) {
        var scope = angular.element(document.getElementById("designer-controller")).scope();
        var object = scope.canvas.getActiveObject();
        var $target = $(e.target);   
        if(e.shiftKey){
            scope.holdShiftKey = true;
        }else{
            scope.holdShiftKey = false;
        }
        switch(e.which) {
            case 37:
                if (object == null || $target.is('textarea,input[type="text"],input[type="number"]')) return;
                if(! object.get("lockMovementX")) {
                    scope.ShiftLeft();
                }
                break;
            case 39:
                if (object == null || $target.is('textarea,input[type="text"],input[type="number"]')) return;
                if(! object.get("lockMovementX")) {
                    scope.ShiftRight();
                }
                break;   
            case 38:
                if (object == null || $target.is('textarea,input[type="text"],input[type="number"]')) return;
                if(! object.get("lockMovementY")) {
                    scope.ShiftUp();
                }
                break;  
            case 40:
                if (object == null || $target.is('textarea,input[type="text"],input[type="number"]')) return;
                if(! object.get("lockMovementY")) {
                    scope.ShiftDown();
                }
                break;    
            case 46:
                if (object == null || $target.is('textarea,input[type="text"],input[type="number"]')) return;                
                deleteObject(scope.editableItem);
                break; 
            case 67:
                if (object == null || $target.is('textarea,input[type="text"],input[type="number"]')) return;                
                if(e.ctrlKey){
                    scope.duplicateItem();
                }
                break;             
            case 90:
                if(e.ctrlKey){
                    scope.undoDesign();
                }
                break;  
            case 89:
                if(e.ctrlKey){
                    scope.redoDesign();
                }
                break;               
            case 107:
                if (object == null || $target.is('textarea,input[type="text"],input[type="number"]')) return;             
                if(e.shiftKey){
                    scope.scaleItem("+");
                }                
                break; 
            case 109:
                if (object == null || $target.is('textarea,input[type="text"],input[type="number"]')) return;             
                if(e.shiftKey){
                    scope.scaleItem("-");
                }  
                break;            
            default: return; 
        }
        if (scope.$root.$$phase !== "$apply" && scope.$root.$$phase !== "$digest") scope.$apply()
    }); 
    $('#dg-myclipart').on('hidden.bs.modal', function () {
        var scope = angular.element(document.getElementById("designer-controller")).scope();
        scope.readyReplaceImage = false;
    })    
});
initTooltip = function(){
    jQuery('.nbd-tooltip-i18n').each( function(){
        var key = jQuery(this).data("lang");
        jQuery(this).tooltip({ 
            trigger: "hover",
            title : langjs[key],
            container : "body"
        }).on('click', function(){
            $(this).tooltip('hide');
        });         
    })
}
